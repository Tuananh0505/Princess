;/*FB_PKG_DELIM*/

__d("CometMessagingJewelDropdownOnboardingUpsellQuery.graphql",["CometMessagingJewelDropdownOnboardingUpsellQuery_facebookRelayOperation","relay-runtime"],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{defaultValue:!1,kind:"LocalArgument",name:"isEBWebPreImprovementsEnabled"}],c={kind:"ClientExtension",selections:[{alias:null,args:null,kind:"ScalarField",name:"is_eb_onboarding_upsells_dismissed",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"is_eb_onboarding_softblocks_dismissed",storageKey:null}]},d={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},e={alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},f={alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"xfb_backup",plural:!1,selections:[e,d],storageKey:null};return{fragment:{argumentDefinitions:a,kind:"Fragment",metadata:null,name:"CometMessagingJewelDropdownOnboardingUpsellQuery",selections:[{args:[{kind:"Literal",name:"isEBEnabled",value:!0},{kind:"Variable",name:"isEBWebPreImprovementsEnabled",variableName:"isEBWebPreImprovementsEnabled"}],kind:"FragmentSpread",name:"CometMessagingJewelDropdownContent_query"},{kind:"RequiredField",field:{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"if_viewer_can_see_messenger_eb_onboarding_softblocks",plural:!1,selections:[{args:null,kind:"FragmentSpread",name:"MWEBOnboardingJewelVariantChooser_viewer"}],storageKey:null},c],storageKey:null},action:"THROW",path:"viewer"}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:a,kind:"Operation",name:"CometMessagingJewelDropdownOnboardingUpsellQuery",selections:[{"if":null,kind:"Defer",label:"MWEncryptedBackupsJewelNuxWrapper_query$defer$MWEncryptedBackupsThreadListRestoreQPWrapperDeferred_query",selections:[{"if":null,kind:"Defer",label:"MWEncryptedBackupsThreadListRestoreQPWrapperDeferred_query$defer$MWEncryptedBackupsThreadListRestoreQPWrapper_query",selections:[{alias:null,args:null,concreteType:"XFBEncryptedBackup",kind:"LinkedField",name:"xfb_backup",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBEBVirtualDevice",kind:"LinkedField",name:"virtual_devices",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"client_generated_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"device_type",storageKey:null},d],storageKey:null},{alias:null,args:[{kind:"Literal",name:"family_device_id",value:""}],kind:"ScalarField",name:"has_otc_eligible_devices",storageKey:'has_otc_eligible_devices(family_device_id:"")'},d],storageKey:null}]}]},{condition:"isEBWebPreImprovementsEnabled",kind:"Condition",passingValue:!0,selections:[f,{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{kind:"ClientExtension",selections:[{alias:null,args:null,kind:"ScalarField",name:"backup_state",storageKey:null}]}],storageKey:null}]},{condition:"isEBWebPreImprovementsEnabled",kind:"Condition",passingValue:!1,selections:[f]},{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"viewer",plural:!1,selections:[{alias:"jewel_qp",args:[{kind:"Literal",name:"surface_nux_id",value:8439},{kind:"Literal",name:"trigger",value:"MESSAGING_JEWEL_OPEN"}],concreteType:"ViewerEligibleQuickPromotionsConnection",kind:"LinkedField",name:"eligible_promotions",plural:!1,selections:[{alias:null,args:null,concreteType:"QuickPromotion",kind:"LinkedField",name:"nodes",plural:!0,selections:[{alias:null,args:null,concreteType:"CometQuickPromotionSections",kind:"LinkedField",name:"comet_qp_sections",plural:!1,selections:[{alias:null,args:[{kind:"Literal",name:"supported",value:"2KN39x"}],concreteType:null,kind:"LinkedField",name:"renderer_strategy",plural:!1,selections:[e,{kind:"InlineFragment",selections:[{args:null,documentName:"CometMessagingJewelDropdownQPBannerContainer_viewer",fragmentName:"CometQuickPromotionMessengerDesktopDownloadBannerRendererStrategy_cometQuickPromotionBaseStrategy",fragmentPropName:"cometQuickPromotionBaseStrategy",kind:"ModuleImport"}],type:"CometQuickPromotionMessengerDesktopDownloadBannerRendererStrategy",abstractKey:null},{kind:"InlineFragment",selections:[{args:null,documentName:"CometMessagingJewelDropdownQPBannerContainer_viewer",fragmentName:"CometQuickPromotionMessengerDesktopDownloadBannerInstructorBeforeClassRendererStrategy_cometQuickPromotionBaseStrategy",fragmentPropName:"cometQuickPromotionBaseStrategy",kind:"ModuleImport"}],type:"CometQuickPromotionMessengerDesktopDownloadBannerInstructorBeforeClassRendererStrategy",abstractKey:null},{kind:"InlineFragment",selections:[{args:null,documentName:"CometMessagingJewelDropdownQPBannerContainer_viewer",fragmentName:"CometQuickPromotionMessengerDesktopDownloadBannerInstructorAfterClassRendererStrategy_cometQuickPromotionBaseStrategy",fragmentPropName:"cometQuickPromotionBaseStrategy",kind:"ModuleImport"}],type:"CometQuickPromotionMessengerDesktopDownloadBannerInstructorAfterClassRendererStrategy",abstractKey:null},{kind:"InlineFragment",selections:[{args:null,documentName:"CometMessagingJewelDropdownQPBannerContainer_viewer",fragmentName:"CometQuickPromotionMessengerDesktopDownloadBannerLearnerBeforeClassRendererStrategy_cometQuickPromotionBaseStrategy",fragmentPropName:"cometQuickPromotionBaseStrategy",kind:"ModuleImport"}],type:"CometQuickPromotionMessengerDesktopDownloadBannerLearnerBeforeClassRendererStrategy",abstractKey:null},{kind:"InlineFragment",selections:[{args:null,documentName:"CometMessagingJewelDropdownQPBannerContainer_viewer",fragmentName:"CometQuickPromotionMessengerDesktopDownloadBannerLearnerAfterClassRendererStrategy_cometQuickPromotionBaseStrategy",fragmentPropName:"cometQuickPromotionBaseStrategy",kind:"ModuleImport"}],type:"CometQuickPromotionMessengerDesktopDownloadBannerLearnerAfterClassRendererStrategy",abstractKey:null},{kind:"InlineFragment",selections:[{args:null,documentName:"CometMessagingJewelDropdownQPBannerContainer_viewer",fragmentName:"CometQuickPromotionMessengerWebEPDBannerRendererStrategy_cometQuickPromotionBaseStrategy",fragmentPropName:"cometQuickPromotionBaseStrategy",kind:"ModuleImport"}],type:"CometQuickPromotionMessengerWebEPDBannerRendererStrategy",abstractKey:null},{kind:"InlineFragment",selections:[{args:null,documentName:"CometMessagingJewelDropdownQPBannerContainer_viewer",fragmentName:"CometQuickPromotionMessengerWebPrivacyPolicyNoticeBannerRendererStrategy_quickPromotionRef",fragmentPropName:"quickPromotionRef",kind:"ModuleImport"}],type:"CometQuickPromotionMessengerWebPrivacyPolicyNoticeBannerRendererStrategy",abstractKey:null},{kind:"InlineFragment",selections:[{args:null,documentName:"CometMessagingJewelDropdownQPBannerContainer_viewer",fragmentName:"CometQuickPromotionArmadilloSecurityAlertsSettingsDefaultOffBannerRendererStrategy_cometQuickPromotionBaseStrategy",fragmentPropName:"cometQuickPromotionBaseStrategy",kind:"ModuleImport"}],type:"CometQuickPromotionArmadilloSecurityAlertsSettingsDefaultOffBannerRendererStrategy",abstractKey:null}],storageKey:'renderer_strategy(supported:"2KN39x")'}],storageKey:null},d],storageKey:null}],storageKey:'eligible_promotions(surface_nux_id:8439,trigger:"MESSAGING_JEWEL_OPEN")'},{alias:null,args:[{kind:"Literal",name:"surface_nux_id",value:10713},{kind:"Literal",name:"trigger",value:"MESSAGING_JEWEL_COMMUNITIES_TAB_OPEN"}],concreteType:"ViewerEligibleQuickPromotionsConnection",kind:"LinkedField",name:"eligible_promotions",plural:!1,selections:[{alias:null,args:null,concreteType:"QuickPromotion",kind:"LinkedField",name:"nodes",plural:!0,selections:[{alias:null,args:null,concreteType:"CometQuickPromotionSections",kind:"LinkedField",name:"comet_qp_sections",plural:!1,selections:[{alias:null,args:[{kind:"Literal",name:"supported",value:"xxYRh"}],concreteType:null,kind:"LinkedField",name:"renderer_strategy",plural:!1,selections:[e,{kind:"InlineFragment",selections:[{args:null,documentName:"CometMessagingJewelCommunitiesQPBannerContainer_viewer",fragmentName:"CometQuickPromotionMessengerWebCommunitiesBannerRendererStrategy_quickPromotionRef",fragmentPropName:"quickPromotionRef",kind:"ModuleImport"}],type:"CometQuickPromotionMessengerWebCommunitiesBannerRendererStrategy",abstractKey:null}],storageKey:'renderer_strategy(supported:"xxYRh")'}],storageKey:null},d],storageKey:null}],storageKey:'eligible_promotions(surface_nux_id:10713,trigger:"MESSAGING_JEWEL_COMMUNITIES_TAB_OPEN")'},{alias:null,args:null,concreteType:"GroupsTab",kind:"LinkedField",name:"groups_tab",plural:!1,selections:[{alias:null,args:null,concreteType:"MessengerGlobalFBGroupChat",kind:"LinkedField",name:"suggested_chats",plural:!0,selections:[d],storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"Viewer",kind:"LinkedField",name:"if_viewer_can_see_messenger_eb_onboarding_softblocks",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"encrypted_backups_onboarding_softblock_variant",storageKey:null}],storageKey:null},c],storageKey:null}]},params:{id:b("CometMessagingJewelDropdownOnboardingUpsellQuery_facebookRelayOperation"),metadata:{},name:"CometMessagingJewelDropdownOnboardingUpsellQuery",operationKind:"query",text:null}}}();b("relay-runtime").PreloadableQueryRegistry.set(a.params.id,a);e.exports=a}),null);
__d("MWEBOnboardingDismissOnboardingUpsellsInRelay",["CometRelay","FBLogger"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.environment,e=a.upsellsToDismiss;d("CometRelay").commitLocalUpdate(b,function(a){a=a.getRoot().getLinkedRecord("viewer");if(a==null){c("FBLogger")("labyrinth_web").mustfix("[labyrinth][onboarding] A viewer record does not exist when dismissing softblocks.");return}switch(e){case"softblocks":a.setValue(!0,"is_eb_onboarding_softblocks_dismissed");break;case"all":a.setValue(!0,"is_eb_onboarding_upsells_dismissed");break}})}g.dismissOnboardingUpsellsInRelayStore=a}),98);
__d("MWEBOnboardingJewelVariantChooser_viewer.graphql",[],(function(a,b,c,d,e,f){"use strict";a={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"MWEBOnboardingJewelVariantChooser_viewer",selections:[{alias:null,args:null,kind:"ScalarField",name:"encrypted_backups_onboarding_softblock_variant",storageKey:null}],type:"Viewer",abstractKey:null};e.exports=a}),null);
__d("MWEBOnboardingJewelVariantChooser.react",["CometRelay","FBLogger","MWEBOnboardingDismissOnboardingUpsellsInRelay","MWEBOnboardingJewelVariantChooser_viewer.graphql","ReQL","ReQLSuspense","deferredLoadComponent","react","requireDeferredForDisplay","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=j||d("react"),l=c("deferredLoadComponent")(c("requireDeferredForDisplay")("MWEBJewelOnboardingSoftblock.react").__setRef("MWEBOnboardingJewelVariantChooser.react")),m=c("deferredLoadComponent")(c("requireDeferredForDisplay")("MWEBJewelOnboardingHardblock.react").__setRef("MWEBOnboardingJewelVariantChooser.react"));function a(a){var e,g=a.children,j=a.dismissJewelSoftblock;a=a.viewer;a=d("CometRelay").useFragment(h!==void 0?h:h=b("MWEBOnboardingJewelVariantChooser_viewer.graphql"),a);var n=(i||(i=c("useReStore")))(),o=d("CometRelay").useRelayEnvironment();e=(e=d("ReQLSuspense").useFirst(function(){return d("ReQL").fromTableAscending(n.tables.encrypted_backups).map(function(a){var b=a.backupId;a=a.isUserOptedOut;return a===!0||b!=null?!1:!0})},[n],f.id+":53"))!=null?e:!0;if(!e)return g;switch(a==null?void 0:a.encrypted_backups_onboarding_softblock_variant){case"ONBOARDING_SOFTBLOCK_1":case"ONBOARDING_SOFTBLOCK_2":return k.jsx(l,{dismissJewelSoftblock:function(){d("MWEBOnboardingDismissOnboardingUpsellsInRelay").dismissOnboardingUpsellsInRelayStore({environment:o,upsellsToDismiss:"softblocks"}),j()}});case"ONBOARDING_HARDBLOCK_1":return k.jsx(m,{dismissJewelSoftblock:function(){d("MWEBOnboardingDismissOnboardingUpsellsInRelay").dismissOnboardingUpsellsInRelayStore({environment:o,upsellsToDismiss:"softblocks"}),j()}});default:c("FBLogger")("labyrinth_web").mustfix("[labyrinth][onboarding] Invalid jewel onboarding variant detected");j();return g}}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("CometMessagingJewelDropdownOnboardingUpsell.react",["fbt","BaseMultiStepContainer.react","CometErrorBoundary.react","CometMessagingJewelDropdownContent.react","CometMessagingJewelDropdownOnboardingUpsellQuery.graphql","CometRelay","CometTopNavListDropdown.react","MWEBOnboardingJewelVariantChooser.react","react","stylex","useTopMostRouteCometEntityKey"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k,l=k||(k=d("react")),m=k.useState;function a(a){var e=a.props.onClose;a=a.queries.jewelUpsellQueryRef;var f=c("useTopMostRouteCometEntityKey")(),g=d("CometRelay").usePreloadedQuery(i!==void 0?i:i=b("CometMessagingJewelDropdownOnboardingUpsellQuery.graphql"),a);a=m(!0);var k=a[0],n=a[1];a=(f==null?void 0:f.entity_type)==="home"&&f.section==="community";if(a)return null;var o=k&&g.viewer.is_eb_onboarding_upsells_dismissed!==!0&&g.viewer.is_eb_onboarding_softblocks_dismissed!==!0&&g.viewer.if_viewer_can_see_messenger_eb_onboarding_softblocks!=null;return l.jsx(c("CometTopNavListDropdown.react"),{label:h._("__JHASH__ptC-BqtItMK__JHASH__"),name:"MWJewelDropdown",children:l.jsx("div",{className:(j||(j=c("stylex")))([c("CometTopNavListDropdown.react").styles.cardWidth]),children:l.jsx(c("BaseMultiStepContainer.react"),{fitContentWidth:!0,children:function(a){var b=l.jsx(c("CometMessagingJewelDropdownContent.react"),{onClose:e,pushPage:a,query:g});return o?l.jsx(c("CometErrorBoundary.react"),{fallback:function(){return b},children:l.jsx(c("MWEBOnboardingJewelVariantChooser.react"),{dismissJewelSoftblock:function(){return n(!1)},viewer:g.viewer.if_viewer_can_see_messenger_eb_onboarding_softblocks,children:b})}):b}})})})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("KeyFilled12.svg.react",["react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){return i.jsxs("svg",babelHelpers["extends"]({viewBox:"0 0 12 13",width:"1em",height:"1em",fill:"currentColor"},a,{children:[a.title!=null&&i.jsx("title",{children:a.title}),a.children!=null&&i.jsx("defs",{children:a.children}),i.jsx("g",{fillRule:"evenodd",transform:"translate(-450 -1073)",children:i.jsxs("g",{children:[i.jsx("path",{d:"M101.25 927.25a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3m7.744-9.5h-1.587a.257.257 0 0 0-.18.074l-3.677 3.678a3.5 3.5 0 1 0 2.2 3.248c0-.521-.117-1.015-.322-1.46l.822-.793v-.747h.75l.751-.751-.001-1.249h1l.5-.5v-1.244a.256.256 0 0 0-.256-.256",transform:"translate(352 156.5)"}),i.jsx("path",{fillRule:"nonzero",d:"M107.407 917.5h1.587c.26 0 .476.197.503.45l.003.056v1.244a.25.25 0 0 1-.048.147l-.025.03-.5.5a.25.25 0 0 1-.138.07l-.039.003H108l.001.998a.25.25 0 0 1-.047.147l-.026.03-.751.752a.25.25 0 0 1-.138.07L107 922h-.5v.497a.25.25 0 0 1-.05.15l-.026.03-.698.673c.18.443.274.916.274 1.4a3.75 3.75 0 1 1-2.684-3.594l.171.055 3.564-3.564a.508.508 0 0 1 .29-.143l.067-.004h1.586-1.587zm1.587.5h-1.589l-3.678 3.679a.25.25 0 0 1-.27.055 3.25 3.25 0 1 0 2.043 3.016c0-.471-.103-.93-.299-1.355a.25.25 0 0 1 .024-.25l.03-.034.745-.72v-.641a.25.25 0 0 1 .205-.246l.045-.004h.646l.605-.605-.001-1.145a.25.25 0 0 1 .205-.246l.045-.004h.896l.354-.354v-1.14l-.002-.004-.004-.002zm-7.744 6a1.75 1.75 0 1 1 0 3.5 1.75 1.75 0 0 1 0-3.5zm0 .5a1.25 1.25 0 1 0 0 2.5 1.25 1.25 0 0 0 0-2.5zm5.75-3h-.104l-.073.073.177-.073z",transform:"translate(352 156.5)"})]})})]}))}a.displayName=a.name+" [from "+f.id+"]";a._isSVG=!0;b=a;g["default"]=b}),98);
__d("LSOcmfClientInit_v2.nop",["CryptoLogger","LSResult","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("ristretto255").__setRef("LSOcmfClientInit_v2.nop");a=function(a,b){return h.load().then(function(a){return c("LSResult")(a.scalar.getRandom().buffer)})["catch"](function(a){d("CryptoLogger").captureError(d("CryptoLogger").CryptoLogger("ocmf_client_init_v2"),a).mustfix("Failed to init OCMF client.");throw a})};g["default"]=a}),98);
__d("LSRandom.nop",["CryptoLogger","I64","LSMaxInt32","LSResult","Promise","XPlatReactCrypto"],(function(a,b,c,d,e,f,g){"use strict";var h,i;a=function(a,e,f){a=d("CryptoLogger").CryptoLogger("ope_encrypt");if((i||(i=d("I64"))).gt(f,c("LSMaxInt32"))){a.mustfix("numBytes '"+String(f)+"' too large. Returning an empty array");return(h||(h=b("Promise"))).resolve(c("LSResult")(new Uint8Array(0).buffer))}e=(i||(i=d("I64"))).to_int32(f);a=new Uint8Array(e);f=65536;for(var g=0;g<e;g+=f){var j=a.subarray(g,g+Math.min(e-g,f));d("XPlatReactCrypto").getRandomValues(j)}return(h||(h=b("Promise"))).resolve(c("LSResult")(a.buffer))};g["default"]=a}),98);
__d("LSInitializeBackup",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateAuthKeyPair.nop","LSCreateDataTrace","LSCreateDataTraceID.nop","LSCreateDebugToken.nop","LSCreateEncryptionKeyPair.nop","LSCreateSignatureKeyPair.nop","LSCreateSignatureWithArmadilloKey.nop","LSCreateSignature_v2.nop","LSGetArmadilloPublicKey.nop","LSGetBlobFromString.nop","LSIsEncryptionVersionSecure","LSIsMobileClient","LSIssueNewTask","LSLogMebClientEvent.nop","LSOcmfClientInit_v2.nop","LSOcmfClientMap.nop","LSRandom.nop","gkx","justknobx"],(function(a,b,c,d,e,f,g){function a(){var a=arguments,d=a[a.length-1],e=[],f=[];return d.sequence([function(g){return d.sequence([function(f){return e[0]=d.i64.of_float(Date.now()),function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsInitializeBackupStoredProcedure] Beginning execution."),(c("gkx")("23657")||c("gkx")("26375"))&&c("justknobx")._("1064")?d.sequence([function(c){return d.i64.eq(a[1],d.i64.cast([0,2]))?e[8]=d.i64.cast([0,198]):e[8]=d.i64.cast([0,70]),a[2]!==void 0?d.sequence([function(a){return e[67]="EncryptedBackups Trace ID",e[68]=d.i64.to_string(e[8]),e[66]="",function(a){d.logger(a).info(a)}(["[EncryptedBackups][MEBTraceUtils] ",e[66],e[67],e[66],e[68]].join("")),d.resolve()},function(c){return d.storedProcedure(b("LSCreateDataTrace"),a[2],void 0,void 0,"backup_init_flow",e[8])},function(b){return e[9]=a[2]}]):d.sequence([function(a){return d.nativeOperation(b("LSCreateDataTraceID.nop")).then(function(a){return a=a,e[66]=a[0],a})},function(a){return e[70]="EncryptedBackups MCD Trace ID",e[71]=d.i64.to_string(e[8]),e[67]="",function(a){d.logger(a).info(a)}(["[EncryptedBackups][MEBTraceUtils] ",e[67],e[70],e[67],e[71]].join("")),d.resolve()},function(a){return d.storedProcedure(b("LSCreateDataTrace"),e[66],void 0,void 0,"backup_init_flow",e[8])},function(a){return d.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,e[68]=a[0],a})},function(a){return e[68]?e[69]=!0:e[69]=!1,e[69]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[72]=d.createArray(),void 0!==void 0?e[73]=(e[72].push(void 0),e[72]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[72],d.i64.cast([0,3]))):d.resolve()},function(a){return e[9]=e[66]}])},function(a){return e[9]!==void 0?d.storedProcedure(b("LSAppendDataTraceAddon"),e[9],d.i64.cast([0,1400]),d.i64.cast([0,2]),void 0,void 0):d.resolve()},function(a){return d.storedProcedure(b("LSIsMobileClient")).then(function(a){return a=a,e[10]=a[0],a})},function(a){return e[10]?e[11]=!0:e[11]=!1,e[11]?(function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils] LSDataTraceMciTraceLog native op not supported"),e[66]=d.createArray(),void 0!==void 0?e[67]=(e[66].push(void 0),e[66]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",e[66],d.i64.cast([0,3]))):d.resolve()},function(c){return d.db.table(168).fetch().next().then(function(c,f){var g=c.done;c=c.value;return g?d.sequence([function(a){return e[66]=d.i64.random(),d.nativeOperation(b("LSCreateSignatureKeyPair.nop")).then(function(a){return a=a,e[67]=a[0],e[68]=a[1],a})},function(a){return d.nativeOperation(b("LSCreateEncryptionKeyPair.nop")).then(function(a){return a=a,e[69]=a[0],e[70]=a[1],a})},function(a){return d.nativeOperation(b("LSCreateAuthKeyPair.nop")).then(function(a){return a=a,e[71]=a[0],e[72]=a[1],a})},function(a){return d.nativeOperation(b("LSRandom.nop"),d.i64.cast([0,32])).then(function(a){return a=a,e[73]=a[0],a})},function(a){return d.nativeOperation(b("LSOcmfClientInit_v2.nop")).then(function(a){return a=a,e[74]=a[0],a})},function(a){return d.nativeOperation(b("LSRandom.nop"),d.i64.cast([0,32])).then(function(a){return a=a,e[75]=a[0],a})},function(a){return e[76]=d.createArray(),d.storedProcedure(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,0])).then(function(a){return a=a,e[77]=a[0],a})},function(a){return e[77]?e[95]=(e[76].push(d.i64.cast([0,0])),e[76]):0,d.storedProcedure(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,2])).then(function(a){return a=a,e[78]=a[0],a})},function(a){return e[78]?e[95]=(e[76].push(d.i64.cast([0,2])),e[76]):0,d.storedProcedure(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,3])).then(function(a){return a=a,e[79]=a[0],a})},function(a){return e[79]?e[95]=(e[76].push(d.i64.cast([0,3])),e[76]):0,d.storedProcedure(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,4])).then(function(a){return a=a,e[80]=a[0],a})},function(a){return e[80]?e[95]=(e[76].push(d.i64.cast([0,4])),e[76]):0,e[81]=d.i64.of_int32(e[76].length),d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[76],d.i64.sub(e[81],d.i64.cast([0,1]))).then(function(a){return a=a,e[82]=a[0],e[83]=a[1],a})},function(a){return d.forEach(d.filter(d.db.table(168).fetch([[[e[66]]]]),function(a){return d.i64.eq(a.backupId,e[66])&&d.i64.lt(a.authorityLevel,d.i64.cast([0,20]))}),function(a){return a["delete"]()})},function(b){return d.db.table(168).add({backupId:e[66],devicePublicKeyBlob:e[68],devicePrivateKeyBlob:e[67],epochStoragePublicKeyBlob:e[70],epochStoragePrivateKeyBlob:e[69],epochAuthPublicKeyBlob:e[72],epochAuthPrivateKeyBlob:e[71],mailboxRootKeyBlob:e[73],ocmfClientStateBlob:e[74],obliviousValidationTokenBlob:e[75],authorityLevel:d.i64.cast([0,20]),encryptionVersion:e[82],revisionVersion:d.i64.cast([0,1]),backupTenancy:a[1]})},function(a){return d.blobs.neq(e[73],void 0)?d.sequence([function(a){return e[95]=new d.Map(),d.nativeOperation(b("LSCreateDebugToken.nop"),e[73],"private_key",e[67],d.i64.cast([0,1]),e[95]).then(function(a){return a=a,e[96]=a[0],a})},function(a){return d.blobs.neq(e[96],void 0)?e[97]=e[96]:e[97]=void 0,e[84]=e[97]}]):d.resolve(e[84]=void 0)},function(a){return d.blobs.neq(e[84],void 0)?d.sequence([function(a){return d.nativeOperation(b("LSBase64Encode.nop"),e[84]).then(function(a){return a=a,e[95]=a[0],a})},function(a){return e[85]=e[95]}]):d.resolve(e[85]=void 0)},function(a){return d.blobs.neq(e[73],void 0)?d.sequence([function(a){return e[95]=new d.Map(),d.nativeOperation(b("LSCreateDebugToken.nop"),e[73],"epoch_storage_private_key",e[69],d.i64.cast([0,1]),e[95]).then(function(a){return a=a,e[96]=a[0],a})},function(a){return d.blobs.neq(e[96],void 0)?e[97]=e[96]:e[97]=void 0,e[86]=e[97]}]):d.resolve(e[86]=void 0)},function(a){return d.blobs.neq(e[86],void 0)?d.sequence([function(a){return d.nativeOperation(b("LSBase64Encode.nop"),e[86]).then(function(a){return a=a,e[95]=a[0],a})},function(a){return e[87]=e[95]}]):d.resolve(e[87]=void 0)},function(a){return d.blobs.neq(e[73],void 0)?d.sequence([function(a){return e[95]=new d.Map(),d.nativeOperation(b("LSCreateDebugToken.nop"),e[73],"epoch_auth_private_key",e[71],d.i64.cast([0,1]),e[95]).then(function(a){return a=a,e[96]=a[0],a})},function(a){return d.blobs.neq(e[96],void 0)?e[97]=e[96]:e[97]=void 0,e[88]=e[97]}]):d.resolve(e[88]=void 0)},function(a){return d.blobs.neq(e[88],void 0)?d.sequence([function(a){return d.nativeOperation(b("LSBase64Encode.nop"),e[88]).then(function(a){return a=a,e[95]=a[0],a})},function(a){return e[89]=e[95]}]):d.resolve(e[89]=void 0)},function(a){return e[94]=d.blob("bWFpbGJveF9yb290X2tleQ=="),d.blobs.neq(e[94],void 0)?d.sequence([function(a){return e[95]=new d.Map(),d.nativeOperation(b("LSCreateDebugToken.nop"),e[94],"mailbox_root_key",e[73],d.i64.cast([0,1]),e[95]).then(function(a){return a=a,e[96]=a[0],a})},function(a){return d.blobs.neq(e[96],void 0)?e[97]=e[96]:e[97]=void 0,e[90]=e[97]}]):d.resolve(e[90]=void 0)},function(a){return d.blobs.neq(e[90],void 0)?d.sequence([function(a){return d.nativeOperation(b("LSBase64Encode.nop"),e[90]).then(function(a){return a=a,e[95]=a[0],a})},function(a){return e[91]=e[95]}]):d.resolve(e[91]=void 0)},function(a){return d.blobs.neq(e[73],void 0)?d.sequence([function(a){return e[95]=new d.Map(),d.nativeOperation(b("LSCreateDebugToken.nop"),e[73],"ocmf_client_state",e[74],d.i64.cast([0,1]),e[95]).then(function(a){return a=a,e[96]=a[0],a})},function(a){return d.blobs.neq(e[96],void 0)?e[97]=e[96]:e[97]=void 0,e[92]=e[97]}]):d.resolve(e[92]=void 0)},function(a){return d.blobs.neq(e[92],void 0)?d.sequence([function(a){return d.nativeOperation(b("LSBase64Encode.nop"),e[92]).then(function(a){return a=a,e[95]=a[0],a})},function(a){return e[93]=e[95]}]):d.resolve(e[93]=void 0)},function(a){return d.db.table(217).put({backupId:e[66],devicePrivateKeyDebugToken:e[85]==null?"":e[85],epochStoragePrivateKeyDebugToken:e[87]==null?"":e[87],epochAuthPrivateKeyDebugToken:e[89]==null?"":e[89],mailboxRootKeyDebugToken:e[91]==null?"":e[91],ocmfClientStateDebugToken:e[93]==null?"":e[93],appVersion:""})},function(b){return b=[e[66],e[68],e[67],e[70],e[69],e[72],e[71],e[73],e[74],void 0,e[75],void 0,a[1],e[82],d.i64.cast([0,1]),d.i64.cast([0,20])],e[12]=b[0],e[13]=b[1],e[14]=b[2],e[15]=b[3],e[16]=b[4],e[17]=b[5],e[18]=b[6],e[19]=b[7],e[20]=b[8],e[21]=b[9],e[22]=b[10],e[23]=b[11],e[24]=b[12],e[25]=b[13],e[26]=b[14],e[27]=b[15],b}]):(f=c.item,d.sequence([function(a){return d.forEach(d.filter(d.db.table(168).fetch(),function(a){return!0}),function(a){var b=a.update;a.item;return b({authorityLevel:d.i64.cast([0,20])})})},function(b){return b=[f.backupId,f.devicePublicKeyBlob,f.devicePrivateKeyBlob,f.epochStoragePublicKeyBlob,f.epochStoragePrivateKeyBlob,f.epochAuthPublicKeyBlob,f.epochAuthPrivateKeyBlob,f.mailboxRootKeyBlob,f.ocmfClientStateBlob,void 0,f.obliviousValidationTokenBlob,void 0,a[1],f.encryptionVersion,f.revisionVersion,f.authorityLevel],e[12]=b[0],e[13]=b[1],e[14]=b[2],e[15]=b[3],e[16]=b[4],e[17]=b[5],e[18]=b[6],e[19]=b[7],e[20]=b[8],e[21]=b[9],e[22]=b[10],e[23]=b[11],e[24]=b[12],e[25]=b[13],e[26]=b[14],e[27]=b[15],b}]))})},function(a){return d.nativeOperation(b("LSBase64Encode.nop"),e[13]).then(function(a){return a=a,e[29]=a[0],a})},function(a){return e[60]=e[29]==null?"":e[29],d.nativeOperation(b("LSBase64Encode.nop"),e[15]).then(function(a){return a=a,e[30]=a[0],a})},function(a){return e[61]=e[30]==null?"":e[30],d.nativeOperation(b("LSCreateSignature_v2.nop"),e[14],d.blob("MA=="),e[15]).then(function(a){return a=a,e[31]=a[0],a})},function(a){return d.nativeOperation(b("LSBase64Encode.nop"),e[31]==null?d.blob("bnVsbA=="):e[31]).then(function(a){return a=a,e[32]=a[0],a})},function(a){return e[62]=e[32]==null?"":e[32],d.nativeOperation(b("LSBase64Encode.nop"),e[17]).then(function(a){return a=a,e[33]=a[0],a})},function(a){return e[63]=e[33]==null?"":e[33],d.nativeOperation(b("LSCreateSignature_v2.nop"),e[14],d.blob("MQ=="),e[17]).then(function(a){return a=a,e[34]=a[0],a})},function(a){return d.nativeOperation(b("LSBase64Encode.nop"),e[34]==null?d.blob("bnVsbA=="):e[34]).then(function(a){return a=a,e[35]=a[0],a})},function(a){return e[64]=e[35]==null?"":e[35],d.nativeOperation(b("LSOcmfClientMap.nop"),e[20],e[22]).then(function(a){return a=a,e[36]=a[0],a})},function(a){return d.nativeOperation(b("LSBase64Encode.nop"),e[36]).then(function(a){return a=a,e[37]=a[0],a})},function(a){return e[65]=e[37]==null?"":e[37],e[38]=d.createArray(),d.storedProcedure(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,0])).then(function(a){return a=a,e[39]=a[0],a})},function(a){return e[39]?e[66]=(e[38].push(d.i64.cast([0,0])),e[38]):0,d.storedProcedure(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,2])).then(function(a){return a=a,e[40]=a[0],a})},function(a){return e[40]?e[66]=(e[38].push(d.i64.cast([0,2])),e[38]):0,d.storedProcedure(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,3])).then(function(a){return a=a,e[41]=a[0],a})},function(a){return e[41]?e[66]=(e[38].push(d.i64.cast([0,3])),e[38]):0,d.storedProcedure(b("LSIsEncryptionVersionSecure"),d.i64.cast([0,4])).then(function(a){return a=a,e[42]=a[0],a})},function(a){return e[42]?e[66]=(e[38].push(d.i64.cast([0,4])),e[38]):0,e[43]="",e[44]=d.i64.of_int32(e[38].length),d.i64.gt(e[44],d.i64.cast([0,0]))?d.loopAsync(e[44],function(a){return e[66]=a,d.sequence([function(a){return d.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),e[38],e[66]).then(function(a){return a=a,e[67]=a[0],e[68]=a[1],a})},function(a){return e[43]=[e[43],"_",d.i64.to_string(e[67])].join("")}])}):d.resolve()},function(a){return d.nativeOperation(b("LSGetBlobFromString.nop"),["supported_versions_",e[43],"revision_version_",d.i64.to_string(d.i64.cast([0,1]))].join("")).then(function(a){return a=a,e[45]=a[0],a})},function(a){return d.nativeOperation(b("LSCreateSignature_v2.nop"),e[14],d.blob("Mg=="),e[45]).then(function(a){return a=a,e[46]=a[0],a})},function(a){return d.blobs.neq(e[46],void 0)?d.sequence([function(a){return d.nativeOperation(b("LSBase64Encode.nop"),e[46]).then(function(a){return a=a,e[66]=a[0],a})},function(a){return e[47]=e[66]}]):d.resolve(e[47]=void 0)},function(a){return d.blobs.neq(e[19],void 0)?d.sequence([function(a){return e[66]=new d.Map(),d.nativeOperation(b("LSCreateDebugToken.nop"),e[19],"private_key",e[14],d.i64.cast([0,1]),e[66]).then(function(a){return a=a,e[67]=a[0],a})},function(a){return d.blobs.neq(e[67],void 0)?e[68]=e[67]:e[68]=void 0,e[48]=e[68]}]):d.resolve(e[48]=void 0)},function(a){return d.blobs.neq(e[48],void 0)?d.sequence([function(a){return d.nativeOperation(b("LSBase64Encode.nop"),e[48]).then(function(a){return a=a,e[66]=a[0],a})},function(a){return e[49]=e[66]}]):d.resolve(e[49]=void 0)},function(a){return e[59]=d.blob("bWFpbGJveF9yb290X2tleQ=="),d.blobs.neq(e[59],void 0)?d.sequence([function(a){return e[66]=new d.Map(),d.nativeOperation(b("LSCreateDebugToken.nop"),e[59],"mailbox_root_key",e[19],d.i64.cast([0,1]),e[66]).then(function(a){return a=a,e[67]=a[0],a})},function(a){return d.blobs.neq(e[67],void 0)?e[68]=e[67]:e[68]=void 0,e[50]=e[68]}]):d.resolve(e[50]=void 0)},function(a){return d.blobs.neq(e[50],void 0)?d.sequence([function(a){return d.nativeOperation(b("LSBase64Encode.nop"),e[50]).then(function(a){return a=a,e[66]=a[0],a})},function(a){return e[51]=e[66]}]):d.resolve(e[51]=void 0)},function(a){return d.blobs.neq(e[19],void 0)?d.sequence([function(a){return e[66]=new d.Map(),d.nativeOperation(b("LSCreateDebugToken.nop"),e[19],"ocmf_client_state",e[20],d.i64.cast([0,1]),e[66]).then(function(a){return a=a,e[67]=a[0],a})},function(a){return d.blobs.neq(e[67],void 0)?e[68]=e[67]:e[68]=void 0,e[52]=e[68]}]):d.resolve(e[52]=void 0)},function(a){return d.blobs.neq(e[52],void 0)?d.sequence([function(a){return d.nativeOperation(b("LSBase64Encode.nop"),e[52]).then(function(a){return a=a,e[66]=a[0],a})},function(a){return e[53]=e[66]}]):d.resolve(e[53]=void 0)},function(a){return d.blobs.neq(e[19],void 0)?d.sequence([function(a){return e[66]=new d.Map(),d.nativeOperation(b("LSCreateDebugToken.nop"),e[19],"epoch_storage_private_key",e[16],d.i64.cast([0,1]),e[66]).then(function(a){return a=a,e[67]=a[0],a})},function(a){return d.blobs.neq(e[67],void 0)?e[68]=e[67]:e[68]=void 0,e[54]=e[68]}]):d.resolve(e[54]=void 0)},function(a){return d.blobs.neq(e[54],void 0)?d.sequence([function(a){return d.nativeOperation(b("LSBase64Encode.nop"),e[54]).then(function(a){return a=a,e[66]=a[0],a})},function(a){return e[55]=e[66]}]):d.resolve(e[55]=void 0)},function(c){return e[56]=new d.Map(),e[56].set("supported_encryption_versions",e[38]),e[56].set("client_version",d.i64.cast([0,1])),e[56].set("version_sig",e[47]==null?"":e[47]),d.i64.eq(a[1],d.i64.cast([0,2]))?d.resolve(e[57]=void 0):d.sequence([function(a){return d.nativeOperation(b("LSGetArmadilloPublicKey.nop")).then(function(a){return a=a,e[66]=a[0],a})},function(a){return e[57]=e[66]}])},function(a){return d.blobs.neq(e[57],void 0)?d.sequence([function(a){return d.nativeOperation(b("LSCreateSignatureWithArmadilloKey.nop"),e[13]).then(function(a){return a=a,e[66]=a[0],a})},function(a){return d.blobs.neq(e[66],void 0)?d.resolve(e[67]=e[66]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoKeySigningUtils] Failed to create labyrinth signature"),e[71]=d.createArray(),void 0!==void 0?e[72]=(e[71].push(void 0),e[71]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoKeySigningUtils","Failed to create labyrinth signature",e[71],d.i64.cast([0,3]))},function(a){return e[67]=void 0}])},function(a){return d.nativeOperation(b("LSCreateSignature_v2.nop"),e[14],d.blob("Mw=="),e[57]).then(function(a){return a=a,e[68]=a[0],a})},function(a){return d.blobs.neq(e[68],void 0)?d.resolve(e[69]=e[68]):d.sequence([function(a){return function(a){d.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoKeySigningUtils] Failed to create armadillo signature"),e[71]=d.createArray(),void 0!==void 0?e[72]=(e[71].push(void 0),e[71]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoKeySigningUtils","Failed to create armadillo signature",e[71],d.i64.cast([0,3]))},function(a){return e[69]=void 0}])},function(a){return d.blobs.neq(e[69],void 0)?(d.blobs.neq(e[67],void 0)?(e[72]=new d.Map(),e[72].set("armadillo_public_key",e[57]),e[72].set("armadillo_key_signature",e[69]),e[72].set("labyrinth_key_signature",e[67]),e[71]=e[72]):e[71]=void 0,e[70]=e[71]):e[70]=void 0,e[58]=e[70]}]):d.resolve(e[58]=void 0)},function(c){return e[58]!==void 0?d.sequence([function(a){return e[66]=e[58].get("armadillo_public_key"),e[58],d.nativeOperation(b("LSBase64Encode.nop"),e[66]).then(function(a){return a=a,e[67]=a[0],a})},function(a){return e[68]=e[58].get("armadillo_key_signature"),e[58],d.nativeOperation(b("LSBase64Encode.nop"),e[68]).then(function(a){return a=a,e[69]=a[0],a})},function(a){return e[70]=e[58].get("labyrinth_key_signature"),e[58],d.nativeOperation(b("LSBase64Encode.nop"),e[70]).then(function(a){return a=a,e[71]=a[0],a})},function(c){return e[72]=new d.Map(),e[72].set("optimistic_backup_id",e[12]),e[72].set("device_public_key",e[60]),e[72].set("epoch_storage_public_key",e[61]),e[72].set("epoch_storage_public_key_sig",e[62]),e[72].set("epoch_auth_public_key",e[63]),e[72].set("epoch_auth_public_key_sig",e[64]),e[72].set("oblivious_validation_token",e[65]),e[72].set("device_registration_id",a[0]),e[72].set("backup_tenancy",a[1]),e[72].set("encryption_version_data",e[56]),e[72].set("trace_id",e[9]),e[72].set("private_key_debug_token",e[49]),e[72].set("mailbox_root_key_debug_token",e[51]),e[72].set("ocmf_client_state_debug_token",e[53]),e[72].set("epoch_storage_pvtkey_debug_token",e[55]),e[72].set("occam_only_eligible",!0),e[72].set("armadillo_public_key",e[67]==null?"":e[67]),e[72].set("armadillo_key_signature",e[69]==null?"":e[69]),e[72].set("labyrinth_key_signature",e[71]==null?"":e[71]),e[73]=d.toJSON(e[72]),d.storedProcedure(b("LSIssueNewTask"),"encrypted_backups_setup",d.i64.cast([0,50001]),e[73],void 0,void 0,d.i64.cast([0,0]),d.i64.cast([0,0]),void 0,void 0,d.i64.cast([0,0]),d.i64.cast([0,0]))}]):(function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsInitializeBackupStoredProcedure] failed to get armadillo key and device signatures"),e[66]=new d.Map(),e[66].set("optimistic_backup_id",e[12]),e[66].set("device_public_key",e[60]),e[66].set("epoch_storage_public_key",e[61]),e[66].set("epoch_storage_public_key_sig",e[62]),e[66].set("epoch_auth_public_key",e[63]),e[66].set("epoch_auth_public_key_sig",e[64]),e[66].set("oblivious_validation_token",e[65]),e[66].set("device_registration_id",a[0]),e[66].set("backup_tenancy",a[1]),e[66].set("encryption_version_data",e[56]),e[66].set("trace_id",e[9]),e[66].set("private_key_debug_token",e[49]),e[66].set("mailbox_root_key_debug_token",e[51]),e[66].set("ocmf_client_state_debug_token",e[53]),e[66].set("epoch_storage_pvtkey_debug_token",e[55]),e[66].set("occam_only_eligible",!0),e[67]=d.toJSON(e[66]),d.storedProcedure(b("LSIssueNewTask"),"encrypted_backups_setup",d.i64.cast([0,50001]),e[67],void 0,void 0,d.i64.cast([0,0]),d.i64.cast([0,0]),void 0,void 0,d.i64.cast([0,0]),d.i64.cast([0,0])))},function(a){return e[1]=d.i64.cast([0,0])}]):d.resolve((function(a){d.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsInitializeBackupStoredProcedure] InitializeBackup flow is disabled"),e[1]=d.i64.cast([0,1])))},function(a){return e[2]=d.i64.of_float(Date.now()),e[3]=d.i64.random(),e[5]="Finishing execution. Execution time: ",e[6]=d.i64.to_string(d.i64.sub(e[2],e[0])),e[7]=" ms",e[4]="",function(a){d.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsInitializeBackupStoredProcedure] ",e[4],e[5],e[4],e[6],e[4],e[7]].join("")),d.i64.eq(d.i64.mod_(e[3],d.i64.cast([0,100])),d.i64.cast([0,0]))?(e[8]=",",e[9]=d.createArray(),void 0!==void 0?e[10]=(e[9].push(void 0),e[9]):0,d.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsInitializeBackupStoredProcedure",[e[5],e[8],e[6],e[8],e[7]].join(""),e[9],d.i64.cast([0,4]))):d.resolve()},function(a){return f[0]=e[1]}])},function(a){return d.resolve(f)}])}d=a;g["default"]=d}),98);
__d("LSInitializeBackupStoredProcedure",["LSInitializeBackup","cr:8709"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.deviceRegistrationId;d[1]=b.backupTenancy;d[2]=b.traceId;return c("LSInitializeBackup").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("MAWEncryptedBackupsInitializeBackupDeferred",["I64","LSAuthorityLevel","LSEncryptedBackupsBackupTenancy","LSEncryptedBackupsOpStatus","LSIntEnum","MWChatEncryptedBackupsQPLEvents","MWEncryptedBackupsDeviceRegistrationId","QPLUserFlow","ReQL","promiseDone","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=c("requireDeferred")("MWEncryptedBackupsFetchBackupIds").__setRef("MAWEncryptedBackupsInitializeBackupDeferred"),k=c("requireDeferred")("MWEncryptedBackupsInitializeBackup").__setRef("MAWEncryptedBackupsInitializeBackupDeferred");function a(a){var b=a.onBackupCreationSuccess,e=a.onFailure,f=a.onStart,g=a.qplEventName,l=g===void 0?d("MWChatEncryptedBackupsQPLEvents").backupSetupQplEvent:g,m=a.db;k.onReady(function(a){var g=d("MWEncryptedBackupsDeviceRegistrationId").getDeviceRegistrationId();if(g==="")return;f==null?void 0:f();c("QPLUserFlow").addPoint(l,"SETUP_INITIALIZE_BACKUP_SPROC_START");c("promiseDone")(a.initializeBackupStoredProcedure(m,(h||(h=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsBackupTenancy").PRODUCTION),g),function(a){a=a[0];if((i||(i=d("I64"))).equal(a,(h||(h=d("LSIntEnum"))).ofNumber(c("LSEncryptedBackupsOpStatus").FAILURE))){c("QPLUserFlow").markError(l,"SETUP_INITIALIZE_BACKUP_SPROC_FAILURE");return e()}c("QPLUserFlow").addPoint(l,"SETUP_INITIALIZE_BACKUP_SPROC_END");var f=m.table("secure_encrypted_backups_client_state").subscribe(function(a,g){if(g.operation==="delete")return;c("promiseDone")(d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(m.tables.secure_encrypted_backups_client_state)),function(a){if(a!=null){a=a[0];(i||(i=d("I64"))).equal(a.authorityLevel,(h||(h=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE))&&(f(),c("QPLUserFlow").addPoint(l,"SETUP_INITIALIZE_BACKUP_END"),j.onReady(function(a){a=a.encryptedBackupsFetchBackupIds;c("promiseDone")(a(m)["finally"](function(){return b==null?void 0:b()}))}));return}c("QPLUserFlow").markError(l,"SETUP_INITIALIZE_BACKUP_SPROC_FAILURE");f();return e()})})},function(){return e()})})}g.initializeBackupDeferred=a}),98);
__d("MWChatEncryptedBackupsPinCodeConfirmStepContentWrapper.react",["FocusRegion.react","MWChatEncryptedBackupsNumericCodeErrorWrapper.react","MWChatEncryptedBackupsNumericCodeInput.react","focusScopeQueries","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){var b=a.inputSize;b=b===void 0?"large":b;a.isMessenger;a=babelHelpers.objectWithoutPropertiesLoose(a,["inputSize","isMessenger"]);return i.jsx(c("MWChatEncryptedBackupsNumericCodeErrorWrapper.react"),{inputSize:b,children:i.jsx(d("FocusRegion.react").FocusRegion,{autoFocusQuery:d("focusScopeQueries").tabbableScopeQuery,children:i.jsx(c("MWChatEncryptedBackupsNumericCodeInput.react"),babelHelpers["extends"]({testid:void 0},a,{inputSize:b}))})})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWEBConnections7AndroidIcon.react",["ix","CometImageFromIXValue.react","react"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||(i=d("react"));i.forwardRef;b=j.forwardRef(a);function a(a,b){var d=a.alt;a=a.xstyle;var e=h("398889");return j.jsx(c("CometImageFromIXValue.react"),{alt:d,ref:b,source:e,xstyle:a})}a.displayName=a.name+" [from "+f.id+"]";e=b;g["default"]=e}),98);
__d("MWEBJewelOnboardingHardblock.react",["BaseMultiStepContainer.react","CometRelay","CometTopNavListDropdown.react","CometTransientDialogProvider.react","JSResourceForInteraction","MWChatEncryptedBackupsQPLEvents","MWChatEncryptedBackupsQPLSource.enum","MWEBFlowSourceContextProvider.react","MWEBOnboardingDismissOnboardingUpsellsInRelay","MWEncryptedBackupsRetrieveQplLoggingAnnotations","MWJewelPopoverDialogContext.react","MWXColumn.react","QPLUserFlow","deferredLoadComponent","react","requireDeferred","requireDeferredForDisplay","useLabyrinthLogging","useMWXLazyDialog","useReStore","useVisibilityObserver"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=i||(i=d("react")),k=i.useContext,l=c("JSResourceForInteraction")("MWEBOnboardingAdvancedOptionsDialog.react").__setRef("MWEBJewelOnboardingHardblock.react"),m=c("deferredLoadComponent")(c("requireDeferredForDisplay")("MWEBOnboardingInsertPINJewelChatTabStep.react").__setRef("MWEBJewelOnboardingHardblock.react")),n=c("deferredLoadComponent")(c("requireDeferred")("MWEBOnboardingConfirmPINJewelChatTabStep.react").__setRef("MWEBJewelOnboardingHardblock.react"));function a(a){var b=a.dismissJewelSoftblock;a=c("useMWXLazyDialog")(l);var e=a[0],f=(h||(h=c("useReStore")))();a=d("useLabyrinthLogging").useLabyrinthLoggingFlow();var g=a.startFlow,i=d("CometRelay").useRelayEnvironment(),o=c("useVisibilityObserver")({onVisible:function(){d("MWEncryptedBackupsRetrieveQplLoggingAnnotations").encryptedBackupsRetrieveQplLoggingAnnotations({db:f,onFetch:function(a){var b=a.firstUpsellTime;a=a.hasUserOnboardedBefore;g({additionalAnnotations:{eb_session_identifier:b,has_user_onboarded_before:a,is_hardblock:"true"},event:d("MWChatEncryptedBackupsQPLEvents").backupSetupQplEvent,source:c("MWChatEncryptedBackupsQPLSource.enum").JEWEL_ONBOARDING_HARDBLOCK});b="ONBOARDING_EB_PIN_INSERT_STEP_IMPRESSION";c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").backupSetupQplEvent,b)}})}});a=k(c("MWJewelPopoverDialogContext.react"));var p=a.setIsOpenForDialog;return j.jsx(c("CometTopNavListDropdown.react").Card,{useFullHeight:!0,useMaxHeight:!0,children:j.jsx(c("MWXColumn.react"),{expanding:!0,children:j.jsx(c("MWEBFlowSourceContextProvider.react"),{source:c("MWChatEncryptedBackupsQPLSource.enum").JEWEL_ONBOARDING_HARDBLOCK,children:j.jsx(c("CometTransientDialogProvider.react"),{children:j.jsx(c("BaseMultiStepContainer.react"),{expanding:!0,children:function(a){return j.jsx(c("MWXColumn.react"),{align:"center",expanding:!0,ref:o,children:j.jsx(m,{isChatTab:!1,isSoftblock:!1,onAdvancedOptions:function(){p(!0),e({source:c("MWChatEncryptedBackupsQPLSource.enum").JEWEL_ONBOARDING_HARDBLOCK})},onNext:function(c){var e=c.enteredPinCode,f=c.setIsMismatchError;a(function(a){a=a.onReturn;return j.jsx(n,{enteredPinCode:e,isChatTab:!1,isSoftblock:!1,onComplete:function(){d("MWEBOnboardingDismissOnboardingUpsellsInRelay").dismissOnboardingUpsellsInRelayStore({environment:i,upsellsToDismiss:"all"}),b()},onReturn:a,setIsMismatchError:f})})}})})}})})})})})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWXIconKey",["MWXSvgIcon","SVGIcon","cr:9191","gkx"],(function(a,b,c,d,e,f,g){"use strict";a=d("MWXSvgIcon").mwxSvgIcon(d("SVGIcon").svgIcon(b("cr:9191")),c("gkx")("23219"));g["default"]=a}),98);
__d("MWEBOnboardingUserEducationContent.react",["fbt","MWXColumn.react","MWXColumnItem.react","MWXIconForListCell.react","MWXIconKey","MWXIconLock","MWXListCell.react","MWXText.react","MWXTextPairing.react","cr:2060","react"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react");function a(a){a=a.isDialog;return j.jsxs(j.Fragment,{children:[j.jsx(c("MWXColumnItem.react"),{align:"center",paddingTop:a?20:0,children:j.jsx(c("MWXColumnItem.react"),{paddingTop:a?8:0,children:j.jsx(b("cr:2060"),{})})}),j.jsx(c("MWXColumnItem.react"),{paddingHorizontal:20,paddingTop:a?16:void 0,paddingVertical:a?void 0:20,children:j.jsx(c("MWXColumnItem.react"),{paddingHorizontal:4,paddingTop:a?void 0:4,children:j.jsx(c("MWXText.react"),{align:"center",type:"headlineEmphasized2",children:h._("__JHASH__ByA4XtmU8eC__JHASH__")})})}),j.jsx(c("MWXColumnItem.react"),{align:"start",children:j.jsxs(c("MWXColumn.react"),{align:"start",paddingVertical:16,spacing:8,children:[j.jsx(c("MWXColumnItem.react"),{align:"start",children:j.jsx(c("MWXListCell.react"),{addOnStart:j.jsx(c("MWXIconForListCell.react"),{hasBackground:!1,icon:c("MWXIconLock"),size:a?"large":"medium"}),addOnStartVerticalAlign:"top",content:j.jsx(c("MWXTextPairing.react"),{body:h._("__JHASH__xl8BbMMiv7B__JHASH__"),bodyColor:"secondary",headline:h._("__JHASH__yyYUK8-M6N4__JHASH__"),headlineColor:"primary",level:4})})}),j.jsx(c("MWXColumnItem.react"),{children:j.jsx(c("MWXListCell.react"),{addOnStart:j.jsx(c("MWXIconForListCell.react"),{hasBackground:!1,icon:c("MWXIconKey"),size:a?"large":"medium"}),addOnStartVerticalAlign:"top",content:j.jsx(c("MWXTextPairing.react"),{body:h._("__JHASH__k0eLJQY0AER__JHASH__"),bodyColor:"secondary",headline:h._("__JHASH__GURBaVq6tn0__JHASH__"),headlineColor:"primary",level:4})})})]})})]})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("useMWEBDeferOnboardingUpsellMutation_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="24191075450539197"}),null);
__d("useMWEBDeferOnboardingUpsellMutation.graphql",["useMWEBDeferOnboardingUpsellMutation_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{alias:null,args:null,concreteType:"XFBMwEbDeferOnboardingSoftblockResponsePayload",kind:"LinkedField",name:"xfb_mw_eb_defer_onboarding_softblock",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"defer_upsell_until",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"useMWEBDeferOnboardingUpsellMutation",selections:a,type:"Mutation",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"useMWEBDeferOnboardingUpsellMutation",selections:a},params:{id:b("useMWEBDeferOnboardingUpsellMutation_facebookRelayOperation"),metadata:{},name:"useMWEBDeferOnboardingUpsellMutation",operationKind:"mutation",text:null}}}();e.exports=a}),null);
__d("useMWEBDeferOnboardingUpsellMutation",["CometRelay","FBLogger","MWEBOnboardingDismissOnboardingUpsellsInRelay","MWEncryptedBackupsLocalStorageEntryEnum","promiseDone","requireDeferred","useMWEBDeferOnboardingUpsellMutation.graphql","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=c("requireDeferred")("MWEncryptedBackupsSharedState").__setRef("useMWEBDeferOnboardingUpsellMutation");function a(){var a=d("CometRelay").useMutation(h!==void 0?h:h=b("useMWEBDeferOnboardingUpsellMutation.graphql")),e=a[0],f=(i||(i=c("useReStore")))(),g=d("CometRelay").useRelayEnvironment();return{deferUpsell:function(){d("MWEBOnboardingDismissOnboardingUpsellsInRelay").dismissOnboardingUpsellsInRelayStore({environment:g,upsellsToDismiss:"softblocks"});return e({onCompleted:function(a){var b=(a=a.xfb_mw_eb_defer_onboarding_softblock)==null?void 0:a.defer_upsell_until;if(b==null){c("FBLogger")("labyrinth_web").mustfix("[labyrinth][onboarding] Failed to store Onboarding softblock defer time locally. Mutation did not return a valid time");return}j.onReady(function(a){a=a.upsertEBSharedStateEntry;c("promiseDone")(a({db:f,stateKey:c("MWEncryptedBackupsLocalStorageEntryEnum").EB_ONBOARDING_DEFER_UPSELL_UNTIL_TIME,stateValue:b.toString()}))})},onError:function(a){a="[labyrinth][onboarding] Failed to defer Onboarding softblock due to: "+a.message;c("FBLogger")("labyrinth_web").mustfix(a)},variables:{}})}}}g["default"]=a}),98);
__d("useMWEBJewelOnboardingSteps",["JSResourceForInteraction","MWJewelPopoverDialogContext.react","deferredLoadComponent","react","requireDeferred","useMWXLazyDialog"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react"));b=h;var j=b.useCallback,k=b.useContext,l=c("JSResourceForInteraction")("MWEBOnboardingAdvancedOptionsDialog.react").__setRef("useMWEBJewelOnboardingSteps"),m=c("deferredLoadComponent")(c("requireDeferred")("MWEBOnboardingInsertPINJewelChatTabStep.react").__setRef("useMWEBJewelOnboardingSteps")),n=c("deferredLoadComponent")(c("requireDeferred")("MWEBOnboardingConfirmPINJewelChatTabStep.react").__setRef("useMWEBJewelOnboardingSteps"));function a(a){var b=a.isSoftblock,d=a.onComplete,e=a.source;a=c("useMWXLazyDialog")(l);var f=a[0];a=k(c("MWJewelPopoverDialogContext.react"));var g=a.setIsOpenForDialog,h=j(function(a){var c=a.enteredPinCode,e=a.pushPage,f=a.setIsMismatchError;e(function(a){a=a.onReturn;return i.jsx(n,{enteredPinCode:c,isChatTab:!1,isSoftblock:b,onComplete:d,onReturn:a,setIsMismatchError:f})})},[b,d]);a=j(function(a){return a(function(c){c=c.onReturn;return i.jsx(m,{isChatTab:!1,isSoftblock:b,onAdvancedOptions:function(){g(!0),f({source:e})},onNext:function(b){var c=b.enteredPinCode;b=b.setIsMismatchError;return h({enteredPinCode:c,pushPage:a,setIsMismatchError:b})},onReturn:c})})},[b,h,g,f,e]);return{pushPinCodeCreateStep:a}}g["default"]=a}),98);
__d("MWEBJewelOnboardingSoftblock.react",["fbt","BaseMultiStepContainer.react","CometRelay","CometTopNavListDropdown.react","CometTransientDialogProvider.react","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsQPLEvents","MWChatEncryptedBackupsQPLSource.enum","MWChatEncryptedBackupsUpsellJewelChatTabLayout.react","MWEBFlowSourceContextProvider.react","MWEBOnboardingDismissOnboardingUpsellsInRelay","MWEBOnboardingUserEducationContent.react","MWEncryptedBackupsRetrieveQplLoggingAnnotations","MWXButton.react","MWXColumn.react","MWXColumnItem.react","MWXLink.react","MWXText.react","QPLUserFlow","gkx","react","useLabyrinthLogging","useMWEBDeferOnboardingUpsellMutation","useMWEBJewelOnboardingSteps","useReStore","useVisibilityObserver"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k=j||d("react"),l=c("gkx")("23219");function a(a){var b=a.dismissJewelSoftblock,e=c("MWChatEncryptedBackupsQPLSource.enum").JEWEL_ONBOARDING_SOFTBLOCK;a=c("useMWEBDeferOnboardingUpsellMutation")();var f=a.deferUpsell,g=d("CometRelay").useRelayEnvironment();a=c("useMWEBJewelOnboardingSteps")({isSoftblock:!0,onComplete:function(){d("MWEBOnboardingDismissOnboardingUpsellsInRelay").dismissOnboardingUpsellsInRelayStore({environment:g,upsellsToDismiss:"all"}),b()},source:e});var j=a.pushPinCodeCreateStep,m=(i||(i=c("useReStore")))();a=d("useLabyrinthLogging").useLabyrinthLoggingFlow();var n=a.startFlow;a=c("useVisibilityObserver")({onVisible:function(){d("MWEncryptedBackupsRetrieveQplLoggingAnnotations").encryptedBackupsRetrieveQplLoggingAnnotations({db:m,onFetch:function(a){var b=a.firstUpsellTime;a=a.hasUserOnboardedBefore;n({additionalAnnotations:{eb_session_identifier:b,has_user_onboarded_before:a,is_hardblock:"false"},event:d("MWChatEncryptedBackupsQPLEvents").backupSetupQplEvent,source:c("MWChatEncryptedBackupsQPLSource.enum").JEWEL_ONBOARDING_SOFTBLOCK});b="ONBOARDING_EB_USER_EDUCATION_STEP_IMPRESSION";c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").backupSetupQplEvent,b)}})}});return k.jsx(c("CometTopNavListDropdown.react").Card,{useFullHeight:!0,useMaxHeight:!0,children:k.jsx(c("MWXColumn.react"),{expanding:!0,paddingHorizontal:16,paddingVertical:0,ref:a,children:k.jsx(c("MWEBFlowSourceContextProvider.react"),{source:e,children:k.jsx(c("CometTransientDialogProvider.react"),{children:k.jsx(c("BaseMultiStepContainer.react"),{expanding:!0,children:function(a){return k.jsx(c("MWChatEncryptedBackupsUpsellJewelChatTabLayout.react"),{size:"large",topItem:{align:"end",item:k.jsx(c("MWXText.react"),{color:"highlight",type:"button2",children:k.jsx(c("MWXLink.react"),{color:l?"primary":"highlight",display:"block",onClick:function(){f(),c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").backupSetupQplEvent,"ONBOARDING_EB_SKIP_CLICK"),d("MWChatEncryptedBackupsLogging").cancelFlow({cancelEndPoint:"SOFTBLOCK_SKIP",event:d("MWChatEncryptedBackupsQPLEvents").backupSetupQplEvent,source:e}),b()},rel:"noreferrer",testid:void 0,children:h._("__JHASH__rCmYlRKYuJA__JHASH__")})})},children:k.jsxs(c("MWXColumn.react"),{children:[k.jsx(c("MWXColumnItem.react"),{children:k.jsx(c("MWEBOnboardingUserEducationContent.react"),{isDialog:!1})}),k.jsx(c("MWXColumn.react"),{paddingVertical:16,children:k.jsx(c("MWXColumnItem.react"),{align:"stretch",paddingTop:4,verticalAlign:"bottom",children:k.jsx(c("MWXButton.react"),{label:h._("__JHASH__jg5vDR-CERP__JHASH__"),onPress:function(){c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").backupSetupQplEvent,"ONBOARDING_EB_CREATE_PIN_CLICK"),j(a)},testid:void 0,type:"primary"})})})]})})}})})})})})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MessengerCheckmark.svg.react",["react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){return i.jsxs("svg",babelHelpers["extends"]({viewBox:"0 0 36 36",width:"1em",height:"1em",fill:"currentColor"},a,{children:[a.title!=null&&i.jsx("title",{children:a.title}),a.children!=null&&i.jsx("defs",{children:a.children}),i.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M26.378 9.169c.597.347.8 1.112.453 1.709l-9 15.5a1.25 1.25 0 0 1-1.965.256l-6.5-6.5a1.25 1.25 0 1 1 1.768-1.768l5.121 5.121a.25.25 0 0 0 .393-.05L24.67 9.621a1.25 1.25 0 0 1 1.709-.453z"})]}))}a.displayName=a.name+" [from "+f.id+"]";a._isSVG=!0;b=a;g["default"]=b}),98);
__d("useCreateEncryptedBackup",["CometRelay","FBLogger","LSDataTraceCheckPoint","LSDataTraceType","LSIntEnum","MAWEncryptedBackupsInitializeBackupDeferred","MAWTraceUtils","MWChatEncryptedBackupsLogging","MWChatEncryptedBackupsQPLEvents","MWEBODSEntityName.enum","MWEncryptedBackupsCreateExtraVirtualDeviceDeferred","MWEncryptedBackupsGenerateRecoveryCode","MWEncryptedBackupsLocalStorageEntryEnum","Promise","QPLUserFlow","VestaBackupSecretRegister","asyncToGeneratorRuntime","gkx","promiseDone","requireDeferred","useLabyrinthLogging","useMWEBFlowSourceContext","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=c("requireDeferred")("MWEncryptedBackupsSharedState").__setRef("useCreateEncryptedBackup"),l=c("requireDeferred")("VestaDeleteAccount").__setRef("useCreateEncryptedBackup");function a(a){var e=a.backupExists,f=a.onInit,g=a.onLabyrinthError,m=a.onSuccess,n=a.onVestaError,o=(j||(j=c("useReStore")))();a=d("useLabyrinthLogging").useLabyrinthLoggingFlow();var p=a.startFlow,q=c("useMWEBFlowSourceContext")(),r=d("CometRelay").useRelayEnvironment(),s=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){try{d("MAWTraceUtils").recordCheckpointForTrace(e,(i||(i=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_PLUGIN_CALLING_INITIALIZE_BACKUP),[],!1);c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").onboardingAuthQplEvent,"ONBOARDING_INIT_BACKUP_START");yield new(h||(h=b("Promise")))(function(b,c){return d("MAWEncryptedBackupsInitializeBackupDeferred").initializeBackupDeferred({db:o,onBackupCreationSuccess:function(){return b()},onFailure:function(){return c()},qplEventName:a})});c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").onboardingAuthQplEvent,"ONBOARDING_INIT_BACKUP_END");c("QPLUserFlow").addPoint(a,"success_backup_initialization");return!0}catch(b){d("MAWTraceUtils").recordCheckpointForTrace(e,(i||(i=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_PIN_SETUP_FAILURE),[],!1,b.message),c("QPLUserFlow").markError(d("MWChatEncryptedBackupsQPLEvents").onboardingAuthQplEvent,"ONBOARDING_INIT_BACKUP_FAILURE"),c("QPLUserFlow").markError(a,"failed_backup_initialization"),c("FBLogger")("labyrinth_web").catching(b).mustfix("[labyrinth][onboarding] Error when initializing backup on device using PIN")}return!1});return function(b,c){return a.apply(this,arguments)}}(),t=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){try{d("MAWTraceUtils").recordCheckpointForTrace(e,(i||(i=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_PLUGIN_CALLING_CREATE_EXTRA_VIRTUAL_DEVICE),[],!1);yield new(h||(h=b("Promise")))(function(a,b){return d("MWEncryptedBackupsCreateExtraVirtualDeviceDeferred").encryptedBackupsCreateExtraVirtualDeviceDeferred({db:o,onFailure:b,onSuccess:a})});c("QPLUserFlow").addPoint(a,"success_device_verification");return!0}catch(b){d("MAWTraceUtils").recordCheckpointForTrace(e,(i||(i=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_PIN_SETUP_FAILURE),[],!1,b.message),c("QPLUserFlow").markError(a,"failed_device_verification"),c("FBLogger")("labyrinth_web").catching(b).mustfix("Error when creating extra virtual device with PIN")}return!1});return function(b,c){return a.apply(this,arguments)}}();return function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){b===void 0&&(b=d("MWChatEncryptedBackupsQPLEvents").backupSetupQplEvent);f==null?void 0:f();var h=d("MAWTraceUtils").startNewTrace((i||(i=d("LSIntEnum"))).ofNumber(c("LSDataTraceType").SAP_VESTA_REGISTRATION),d("MAWTraceUtils").CONTEXT_VESTA_REGISTRATION);c("QPLUserFlow").addAnnotations(b,{string:{source:q()}});var j;try{d("MAWTraceUtils").recordCheckpointForTrace(h,(i||(i=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_PLUGIN_CALLING_GENERATE_RECOVERY_CODE),[],!1);p({event:d("MWChatEncryptedBackupsQPLEvents").onboardingAuthQplEvent,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_ONBOARDING_AUTH});c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").onboardingAuthQplEvent,"ONBOARDING_RECOVERY_CODE_GENERATE_START");c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").backupSetupQplEvent,"SETUP_RECOVERY_CODE_GENERATE_START");var u=(yield d("MWEncryptedBackupsGenerateRecoveryCode").encryptedBackupsGenerateRecoveryCode({db:o,virtualDeviceType:2})),v=u.recoveryCode;u=u.virtualDeviceId;j=u;if(v==null||u==null){c("FBLogger")("labyrinth_web").mustfix("Cannot setup a PIN Code without a recovery code");d("MAWTraceUtils").recordFailureAndFlushForTraceId(h,(i||(i=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_PIN_SETUP_FAILURE),[],"Cannot setup a PIN Code without a recovery code");c("QPLUserFlow").markError(b,"SETUP_RECOVERY_CODE_GENERATE_FAILURE");d("MWChatEncryptedBackupsLogging").endFailure({annotations:{string:{errorReason:"ONBOARDING_RECOVERY_CODE_GENERATE_FAILURE"}},errorName:"ONBOARDING_RECOVERY_CODE_GENERATE_FAILURE",event:d("MWChatEncryptedBackupsQPLEvents").onboardingAuthQplEvent,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_ONBOARDING_AUTH});g==null?void 0:g();return}d("MAWTraceUtils").recordCheckpointForTrace(h,i.ofNumber(c("LSDataTraceCheckPoint").SAP_VESTA_CALLING_VESTA_REGISTRATION),[],!1);var w=new TextEncoder();c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").onboardingAuthQplEvent,"ONBOARDING_SAP_VESTA_REGISTRATION_START");c("QPLUserFlow").addPoint(b,"SETUP_SAP_VESTA_REGISTRATION_START");yield d("VestaBackupSecretRegister").vestaBackupSecretRegister({environment:r,input:{clientId:u,productUseCase:c("gkx")("24066")?"IGD_ENC_BACKUP":"MSGR_ENC_BACKUP",secret:w.encode(v),vestaAccountPin:a}});c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").onboardingAuthQplEvent,"ONBOARDING_SAP_VESTA_REGISTRATION_END");c("QPLUserFlow").addPoint(b,"SETUP_SAP_VESTA_REGISTRATION_END");d("MAWTraceUtils").recordCheckpointForTrace(h,i.ofNumber(c("LSDataTraceCheckPoint").SAP_VESTA_REGISTRATION_COMPLETION),[],!1);w=e?yield t(b,h):yield s(b,h);if(w)d("MAWTraceUtils").recordSuccessAndFlushForTraceId(h,(i||(i=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_PIN_SETUP_SUCCESS),[]),k.onReady(function(a){a=a.upsertEBSharedStateEntry;c("promiseDone")(a({db:o,stateKey:c("MWEncryptedBackupsLocalStorageEntryEnum").ENCRYPTED_BACKUPS_ONBOARDED_SUCCESSFULLY}))}),m&&m(),d("MWChatEncryptedBackupsLogging").endSuccess({event:d("MWChatEncryptedBackupsQPLEvents").onboardingAuthQplEvent,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_ONBOARDING_AUTH}),d("MWChatEncryptedBackupsLogging").endSuccess({annotations:{string:{setup_type:"pin_code"}},event:b});else{c("QPLUserFlow").markError(b,"pin_code_create_vd_error");d("MAWTraceUtils").recordCheckpointForTrace(h,(i||(i=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_PIN_SETUP_FAILURE),[],!1,"Virtual device creation failure");c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").onboardingAuthQplEvent,"ONBOARDING_DELETE_VESTA_ACCOUNT_START");v=(yield l.load());a=v.vestaDeleteAccount;a({clientId:u,environment:r,productUseCase:"MSGR_ENC_BACKUP",updater:function(a){var b;b=(b=a.getRootField("fbid_based_auth_layer_vesta_delete_account"))==null?void 0:b.getLinkedRecord("vesta_user_info");if(b!=null){(a=a.getRoot())==null?void 0:(a=a.getLinkedRecord("viewer"))==null?void 0:(a=a.getLinkedRecord("messenger_default_encrypted_backup"))==null?void 0:(a=a.getLinkedRecord("vesta_user_info"))==null?void 0:a.copyFieldsFrom(b)}}});c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").onboardingAuthQplEvent,"ONBOARDING_DELETE_VESTA_ACCOUNT_END");d("MWChatEncryptedBackupsLogging").endFailure({annotations:{string:{errorReason:"ONBOARDING_VIRTUAL_DEVICE_CREATE_FAILURE"}},errorName:"ONBOARDING_RECOVERY_CODE_GENERATE_FAILURE",event:d("MWChatEncryptedBackupsQPLEvents").onboardingAuthQplEvent,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_ONBOARDING_AUTH});d("MAWTraceUtils").recordCheckpointForTrace(h,i.ofNumber(c("LSDataTraceCheckPoint").FLOW_END_FOR_FAILURE),[],!0);g==null?void 0:g()}}catch(a){if(j!=null){w=(yield l.load());v=w.vestaDeleteAccount;v({clientId:j,environment:r,productUseCase:"MSGR_ENC_BACKUP",updater:function(a){var b;b=(b=a.getRootField("fbid_based_auth_layer_vesta_delete_account"))==null?void 0:b.getLinkedRecord("vesta_user_info");if(b!=null){(a=a.getRoot())==null?void 0:(a=a.getLinkedRecord("viewer"))==null?void 0:(a=a.getLinkedRecord("messenger_default_encrypted_backup"))==null?void 0:(a=a.getLinkedRecord("vesta_user_info"))==null?void 0:a.copyFieldsFrom(b)}}})}c("QPLUserFlow").markError(b,"pin_code_vesta_error");d("MWChatEncryptedBackupsLogging").endFailure({annotations:{string:{errorReason:a.toString()}},errorName:"ONBOARDING_UNKNOWN_FAILURE",event:d("MWChatEncryptedBackupsQPLEvents").onboardingAuthQplEvent,odsEntityName:c("MWEBODSEntityName.enum").MW_EB_ONBOARDING_AUTH});d("MAWTraceUtils").recordFailureAndFlushForTraceId(h,(i||(i=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").LABYRINTH_PIN_SETUP_FAILURE),[],a.toString());n==null?void 0:n();c("FBLogger")("labyrinth_web").catching(a).mustfix("[labyrinth][onboarding] Error when setting the pin code up")}});return function(b,c){return a.apply(this,arguments)}}()}g["default"]=a}),98);
__d("useMWChatEncryptedBackupsOnPinCodeSetup",["fbt","ix","BaseToasterStateManager","CometIcon.react","ImageIconSource","MWChatEncryptedBackupsQPLEvents","MessengerCheckmark.svg.react","QPLUserFlow","SVGIcon","fbicon","mwPushToast","react","useCreateEncryptedBackup"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j,k=j||(j=d("react")),l=j.useRef,m=c("BaseToasterStateManager").getInstance();function a(a){var b=a.backupExists,d=a.onFinish,e=a.onStart,f=l(null);return c("useCreateEncryptedBackup")({backupExists:b,onInit:function(){f.current=n(),e()},onLabyrinthError:function(){d==null?void 0:d(),f.current=p(f)},onSuccess:function(){d==null?void 0:d(),f.current=o(f)},onVestaError:function(){d==null?void 0:d(),f.current=p(f)}})}function n(){var a=60*60*24*1e3;c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").backupSetupQplEvent,"pin_code_creation_begin_toast");return d("mwPushToast").mwPushToast({icon:{comet:k.jsx(c("CometIcon.react"),{icon:d("fbicon")._(i("600425"),24)}),mds:new(c("ImageIconSource"))(i("275859"),24,24)},title:h._("__JHASH__WGiOq063ARQ__JHASH__")},a)}function o(a){q(a);c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").backupSetupQplEvent,"pin_code_creation_success_toast");return d("mwPushToast").mwPushToast({icon:{comet:k.jsx(c("CometIcon.react"),{icon:d("fbicon")._(i("498147"),24)}),mds:d("SVGIcon").svgIcon(c("MessengerCheckmark.svg.react"))},testid:"mw-encrypted-backups-pin-code-created-toast",title:h._("__JHASH__GRzS01HyFZL__JHASH__")})}function p(a){q(a);c("QPLUserFlow").addPoint(d("MWChatEncryptedBackupsQPLEvents").backupSetupQplEvent,"pin_code_creation_failed_toast");return d("mwPushToast").mwPushErrorToast({body:h._("__JHASH__BWw-RBgtM2W__JHASH__")})}function q(a){if(a.current==null)return;m.expire(a.current);a.current=null}g["default"]=a}),98);
__d("MWEBOnboardingConfirmPINJewelChatTabStep.react",["fbt","MWChatEncryptedBackupsPinCodeConfirmStepContentWrapper.react","MWChatEncryptedBackupsQPLEvents","MWChatEncryptedBackupsUpsellJewelChatTabLayout.react","MWEBConnections4AndroidIcon.react","MWEBPinCodeSize","MWXCircleButton.react","MWXColumn.react","MWXColumnItem.react","MWXIconArrowLeft","MWXText.react","promiseDone","react","useEncryptedBackupsQplImpressionRef","useMWChatEncryptedBackupsNumericCode","useMWChatEncryptedBackupsOnPinCodeSetup","xplatToDOMRef"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react"),k="eb-onboarding-insert-pin-dialog-step";function a(a){var b=a.enteredPinCode,e=a.isChatTab,f=a.isSoftblock,g=a.onComplete,i=a.onReturn,l=a.setIsMismatchError;a=c("useEncryptedBackupsQplImpressionRef")(d("MWChatEncryptedBackupsQPLEvents").backupSetupQplEvent,e?"ONBOARDING_EB_PIN_CONFIRM_STEP_IMPRESSION":"ONBOARDING_EB_PIN_CONFIRM_STEP_IMPRESSION");var m=c("useMWChatEncryptedBackupsOnPinCodeSetup")({backupExists:!1,onStart:g});g=d("useMWChatEncryptedBackupsNumericCode").useMWChatEncryptedBackupsNumericCode({checkPreviouslyInsertedCode:{onCodeMismatch:function(){l(!0),i()},previouslyInsertedCode:b},focusRegionId:k,inputSize:d("MWEBPinCodeSize").EB_PIN_CODE_SIZE,onComplete:function(a){c("promiseDone")(m(a,d("MWChatEncryptedBackupsQPLEvents").backupSetupQplEvent))}});b=g[0];return j.jsx(c("MWChatEncryptedBackupsUpsellJewelChatTabLayout.react"),{size:e?"small":"large",topItem:{align:"start",item:j.jsx(c("MWXCircleButton.react"),{color:"primary",icon:c("MWXIconArrowLeft"),label:h._("__JHASH__iiLaSTIoRxT__JHASH__"),onPress:i,size:32})},children:j.jsxs(c("MWXColumn.react"),{align:"center",paddingHorizontal:16,ref:d("xplatToDOMRef").xplatToDOMRef(a),children:[j.jsx(c("MWXColumnItem.react"),{children:j.jsx(c("MWEBConnections4AndroidIcon.react"),{size:e?"small":"large"})}),j.jsx(c("MWXColumnItem.react"),{paddingHorizontal:e?0:20,paddingTop:e?0:20,children:j.jsx("div",{className:"x78zum5 x141feeh",children:j.jsx(c("MWXColumnItem.react"),{paddingHorizontal:e?0:20,paddingTop:e?0:8,verticalAlign:"bottom",children:j.jsx("div",{className:"xpvyfi4 x3ajldb",children:j.jsx(c("MWXText.react"),{align:"center",type:"headlineEmphasized2",children:h._("__JHASH__W_GWxxYDFas__JHASH__")})})})})}),j.jsx(c("MWXColumnItem.react"),{align:"center",paddingHorizontal:e?0:16,paddingTop:20,children:j.jsx(c("MWXColumnItem.react"),{paddingVertical:e?0:12,children:j.jsx(c("MWXText.react"),{align:"center",color:"secondary",type:"body3",children:f?h._("__JHASH__Vsvqe98kDcX__JHASH__"):h._("__JHASH__uby5jrnVZdh__JHASH__")})})}),j.jsx(c("MWXColumnItem.react"),{paddingTop:e?12:20,children:j.jsx(c("MWXColumnItem.react"),{align:"center",paddingTop:e?0:8,children:j.jsx(c("MWChatEncryptedBackupsPinCodeConfirmStepContentWrapper.react"),babelHelpers["extends"]({isMessenger:!1},b,{inputSize:e?"tiny":"small"}))})}),e?null:j.jsx(c("MWXColumn.react"),{paddingVertical:20,children:j.jsx(c("MWXColumnItem.react"),{paddingTop:12,children:j.jsx("div",{className:"xx9tyur"})})})]})})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWEBOnboardingInsertPINJewelChatTabStep.react",["fbt","FocusRegion.react","MWChatEncryptedBackupsNumericCodeErrorWrapper.react","MWChatEncryptedBackupsNumericCodeInput.react","MWChatEncryptedBackupsQPLEvents","MWChatEncryptedBackupsUpsellJewelChatTabLayout.react","MWEBConnections4AndroidIcon.react","MWEBPinCodeSize","MWXCircleButton.react","MWXColumn.react","MWXColumnItem.react","MWXIconArrowLeft","MWXLink.react","MWXText.react","focusScopeQueries","react","useEncryptedBackupsQplImpressionRef","useMWChatEncryptedBackupsNumericCode","xplatToDOMRef"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||(i=d("react")),k=i.useState,l="eb-onboarding-insert-pin-dialog-step";function a(a){var b=a.isChatTab,e=a.isSoftblock,f=a.onAdvancedOptions,g=a.onNext;a=a.onReturn;var i=c("useEncryptedBackupsQplImpressionRef")(d("MWChatEncryptedBackupsQPLEvents").backupSetupQplEvent,b?"ONBOARDING_EB_PIN_INSERT_STEP_IMPRESSION":"ONBOARDING_EB_PIN_INSERT_STEP_IMPRESSION"),m=k(!1),n=m[0],o=m[1];m=d("useMWChatEncryptedBackupsNumericCode").useMWChatEncryptedBackupsNumericCode({clearInputOnComplete:!0,focusRegionId:l,inputSize:d("MWEBPinCodeSize").EB_PIN_CODE_SIZE,onChange:function(){o(!1)},onComplete:function(a){g({enteredPinCode:a,setIsMismatchError:o})}});m=m[0];f=j.jsx(c("MWXText.react"),{color:"highlight",type:"button2",children:j.jsx(c("MWXLink.react"),{color:"highlight",display:"block",onClick:f,rel:"noreferrer",testid:void 0,children:h._("__JHASH__OFSirhauIwo__JHASH__")})});return j.jsx(c("MWChatEncryptedBackupsUpsellJewelChatTabLayout.react"),{bottomItem:b?f:null,size:b?"small":"large",topItem:a!=null?{align:"start",item:j.jsx(c("MWXCircleButton.react"),{color:"primary",icon:c("MWXIconArrowLeft"),label:h._("__JHASH__iiLaSTIoRxT__JHASH__"),onPress:a,size:32})}:void 0,children:j.jsxs(c("MWXColumn.react"),{align:"center",paddingHorizontal:16,ref:e?d("xplatToDOMRef").xplatToDOMRef(i):void 0,children:[j.jsx(c("MWXColumnItem.react"),{children:j.jsx(c("MWEBConnections4AndroidIcon.react"),{size:b?"small":"large"})}),j.jsx(c("MWXColumnItem.react"),{paddingHorizontal:b?0:20,paddingTop:b?0:20,children:j.jsx("div",{className:"x78zum5 x141feeh",children:j.jsx("div",{className:"xpvyfi4 x3ajldb",children:j.jsx(c("MWXColumnItem.react"),{expanding:!0,paddingHorizontal:b?0:20,paddingTop:b?0:8,verticalAlign:"bottom",children:j.jsx(c("MWXText.react"),{align:"center",type:"headlineEmphasized2",children:e?h._("__JHASH__j1PPYbB6TSt__JHASH__"):h._("__JHASH__gT1Ykyy4TK3__JHASH__")})})})})}),j.jsx(c("MWXColumnItem.react"),{paddingHorizontal:b?0:16,paddingTop:20,children:j.jsx(c("MWXColumnItem.react"),{paddingVertical:b?0:12,children:j.jsx(c("MWXText.react"),{align:"center",color:"secondary",type:"body3",children:e?h._("__JHASH__Vsvqe98kDcX__JHASH__"):h._("__JHASH__uby5jrnVZdh__JHASH__")})})}),j.jsx(c("MWXColumnItem.react"),{align:"center",paddingTop:b?16:20,children:j.jsx(c("MWChatEncryptedBackupsNumericCodeErrorWrapper.react"),{error:n?h._("__JHASH__ZgT6jixU811__JHASH__"):void 0,inputSize:b?"tiny":"small",children:j.jsx(d("FocusRegion.react").FocusRegion,{autoFocusQuery:d("focusScopeQueries").tabbableScopeQuery,id:l+"-input",children:j.jsx(c("MWChatEncryptedBackupsNumericCodeInput.react"),babelHelpers["extends"]({testid:void 0},m,{inputSize:b?"tiny":"small"}))})})}),b?null:j.jsx(c("MWXColumn.react"),{paddingVertical:20,children:j.jsx(c("MWXColumnItem.react"),{paddingTop:12,children:f})})]})})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWEncryptedBackupsInitializeBackup",["LSFactory","LSInitializeBackupStoredProcedure"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,d){return a.runInTransaction(function(a){return c("LSInitializeBackupStoredProcedure")(c("LSFactory")(a),{backupTenancy:b,deviceRegistrationId:d})},"readwrite")}g.initializeBackupStoredProcedure=a}),98);