;/*FB_PKG_DELIM*/

__d("LSGetNextEpochAnonId.nop",["CryptoLogger","LSCryptoUtils","LSResult","Promise","XPlatReactTextDecoder"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(a,e,f){a=d("LSCryptoUtils").strToBuf("0");if(f!=null){e=f;if(e.byteLength===0)f=a;else{var g=new(d("XPlatReactTextDecoder").TextDecoder)();g=g.decode(e);e=Number.parseInt(g,10);g=e+1;f=d("LSCryptoUtils").strToBuf(String(g))}}else f=a;return(h||(h=b("Promise"))).resolve(c("LSResult")(f))["catch"](function(a){d("CryptoLogger").captureError(d("CryptoLogger").CryptoLogger("get_next_epoch_anonid"),a).mustfix("Getting next epoch anon id failed");throw a})};g["default"]=a}),98);
__d("PublicKeyEncryptionUtils",["Promise","UInt8Array","XPlatReactCrypto"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){}function c(a){if(a!=null)return a;else return new Uint8Array(0).buffer}function e(a,b,c,e,f){return d("UInt8Array").concatBytes([a,b,c,e,f]).buffer}function f(a,b,c,e){return d("XPlatReactCrypto").subtleImportKey("raw",a.buffer,"HKDF",!1,["deriveKey"]).then(function(a){return d("XPlatReactCrypto").subtleDeriveKey({hash:"SHA-256",info:c,name:"HKDF",salt:b},a,{length:256,name:"AES-GCM"},!1,[e])})}var i="key length is not "+32;function j(a,b){if(a.length!==32)return b(i)}function k(a){return new(h||(h=b("Promise")))(function(b,c){j(a,c);return b()})}var l=32;g.assertValidCurvePoint=a;g.getSalt=c;g.concatAad=e;g.getAesKey=f;g.testKeyLength=j;g.assertKeyLength=k;g.keyLength=l}),98);
__d("LSPublicEncryptionCreateDecryptedData.nop",["CryptoLogger","Promise","PublicKeyEncryptionUtils","RetUtil","XPlatReactCrypto","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=c("requireDeferred")("PublicKeyCrypto").__setRef("LSPublicEncryptionCreateDecryptedData.nop"),j=c("requireDeferred")("X25519").__setRef("LSPublicEncryptionCreateDecryptedData.nop");function k(a,b){var c=1+d("PublicKeyEncryptionUtils").keyLength+16;a=a.length;a<1+d("PublicKeyEncryptionUtils").keyLength+16&&b("CipherText length is "+a+", < "+c)}function l(a,b,c){b=b[0];if(b!==a)return c("Unexpected version "+b)}function m(a){return new(h||(h=b("Promise")))(function(b,c){l(1,a,c);k(a,c);return b()})}function n(a,c){return new(h||(h=b("Promise")))(function(b,e){d("PublicKeyEncryptionUtils").assertValidCurvePoint(a,e);d("PublicKeyEncryptionUtils").assertValidCurvePoint(c,e);return b()})}a=function(a,c,e,f,g,k,l,o){var p=new Uint8Array(l),q=new Uint8Array([1]),r=d("PublicKeyEncryptionUtils").getSalt(k),s=new Uint8Array(e),t=new Uint8Array(g),u=new Uint8Array(f),v=new Uint8Array(o);return(h||(h=b("Promise"))).all([d("PublicKeyEncryptionUtils").assertKeyLength(s),d("PublicKeyEncryptionUtils").assertKeyLength(u),d("PublicKeyEncryptionUtils").assertKeyLength(t)]).then(function(){return m(v)}).then(function(){return j.load()}).then(function(a){var c=v.slice(1,d("PublicKeyEncryptionUtils").keyLength+1),e=a.publicKeyFromBytes(c,a.KeyPurpose.Encryption);return n(e,t).then(function(){var f=d("PublicKeyEncryptionUtils").concatAad(q,t,s,c,p),g=function(c,d,f){c=a.publicKeyFromBytes(c,a.KeyPurpose.Encryption);d=a.publicKeyFromBytes(d,a.KeyPurpose.Encryption);f=a.secretKeyFromBytes(f,a.KeyPurpose.Encryption);return c==null||d==null||f==null||e==null?(h||(h=b("Promise"))).resolve():(h||(h=b("Promise"))).resolve([c,d,f,e])};return g(s,t,u).then(function(a){if(a==null)return;return{ephemeralPub:a[3],innerAad:f,receiverPriv:a[2],receiverPub:a[0],senderPub:a[1]}})})}).then(function(a){if(a==null)return;var b=a.ephemeralPub,c=a.receiverPriv,e=a.senderPub,f=a.innerAad;return i.load().then(function(a){return a.receiverDeriveSharedSecret(c,b,e)}).then(function(a){if(a==null)return null;else return d("PublicKeyEncryptionUtils").getAesKey(a,r,f,"decrypt")}).then(function(a){if(a==null)return;var b=new Uint8Array(12).buffer,c=v.slice(d("PublicKeyEncryptionUtils").keyLength+1).buffer;return d("XPlatReactCrypto").subtleDecrypt({additionalData:f,iv:new Uint8Array(b),name:"AES-GCM",tagLength:128},a,c)})}).then(function(a){return(h||(h=b("Promise"))).resolve(d("RetUtil").getNullableRetResult(a))})["catch"](function(a){var c=d("CryptoLogger").CryptoLogger("public_encryption_create_decrypted_data");d("CryptoLogger").captureError(c,a).mustfix("Creation of decrypted data for public encryption failed");return(h||(h=b("Promise"))).resolve(d("RetUtil").getNullableRetResult(void 0))})};g["default"]=a}),98);
__d("LSDeriveAndStoreEpochs",["LSArrayGetObjectAt","LSBase64Decode.nop","LSBase64Encode.nop","LSCreateDerivedKeys.nop","LSGetBlobFromString.nop","LSGetNextEpochAnonId.nop","LSIsEncryptionVersionSecure","LSIssueNewTask","LSLogMebClientEvent.nop","LSPublicEncryptionCreateDecryptedData.nop","LSSymmetricEncryptionCreateDecryptedString.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure] Beginning execution."),d[1]=c.i64.of_int32(a[0].length),c.i64.gt(d[1],c.i64.cast([0,0]))?c.sequence([function(e){return d[8]=c.i64.of_float(Date.now()),c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(e,f){var g=e.done;e=e.value;return g?c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure] Unable to load client state: 1"),d[20]=c.createArray(),void 0!==void 0?d[23]=(d[20].push(void 0),d[20]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure","Unable to load client state: 1",d[20],c.i64.cast([0,3]))},function(e){return d[21]=c.createArray(),d[22]=c.i64.of_int32(a[0].length),c.i64.gt(d[22],c.i64.cast([0,0]))?c.loopAsync(d[22],function(e){return d[23]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[0],d[23]).then(function(a){return a=a,d[24]=a[0],d[25]=a[1],a})},function(a){return d[26]=d[24].get("from_epoch"),d[24],d[27]=d[26].get("epoch_anon_id"),d[26],c.nativeOperation(b("LSBase64Encode.nop"),d[27]).then(function(a){return a=a,d[28]=a[0],a})},function(a){return d[28]!==void 0?d[29]=d[28]:d[29]="",d[30]=d[24].get("from_epoch"),d[24],d[31]=d[30].get("epoch_id"),d[30],d[32]=new c.Map(),d[32].set("anon_id",d[29]),d[32].set("epoch_id",d[31]),d[33]=d[24].get("to_epoch"),d[24],d[34]=d[33].get("epoch_anon_id"),d[33],c.nativeOperation(b("LSBase64Encode.nop"),d[34]).then(function(a){return a=a,d[35]=a[0],a})},function(a){return d[35]!==void 0?d[36]=d[35]:d[36]="",d[37]=d[24].get("to_epoch"),d[24],d[38]=d[37].get("epoch_id"),d[37],d[39]=new c.Map(),d[39].set("anon_id",d[36]),d[39].set("epoch_id",d[38]),d[40]=d[24].get("forward_edge"),d[24],d[40]?d[41]=!1:d[41]=!0,d[41]?d[42]=!1:d[42]=!0,d[43]=d[24].get("backward_edge"),d[24],c.blobs.neq(d[43],void 0)?d[44]=!0:d[44]=!1,d[45]=new c.Map(),d[45].set("from",d[32]),d[45].set("to",d[39]),d[45].set("has_forward_edge",d[42]),d[45].set("has_backward_edge",d[44]),d[45].set("result_code",c.i64.cast([0,7])),d[45].set("error_message",void 0),d[46]=(d[21].push(d[45]),d[21])}])}):c.resolve()},function(b){return b=[void 0,void 0,void 0,a[2],c.i64.cast([0,0]),c.i64.cast([0,0]),d[21]],d[9]=b[0],d[10]=b[1],d[11]=b[2],d[12]=b[3],d[13]=b[4],d[14]=b[5],d[15]=b[6],b}]):(f=e.item,c.sequence([function(a){return d[33]=f.epochStoragePublicKeyBlob,d[32]=f.deviceId,d[31]=f.backupTenancy,d[30]=f.encryptionVersion,c.i64.neq(void 0,void 0)?c.resolve(d[20]=void 0):c.sequence([function(a){return d[34]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[35]=a[0],a})},function(a){return d[35]?d[44]=(d[34].push(c.i64.cast([0,0])),d[34]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[36]=a[0],a})},function(a){return d[36]?d[44]=(d[34].push(c.i64.cast([0,2])),d[34]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[37]=a[0],a})},function(a){return d[37]?d[44]=(d[34].push(c.i64.cast([0,3])),d[34]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[38]=a[0],a})},function(a){return d[38]?d[44]=(d[34].push(c.i64.cast([0,4])),d[34]):0,d[39]=c.createArray(),d[40]=c.i64.of_int32(d[34].length),c.i64.gt(d[40],c.i64.cast([0,0]))?c.loopAsync(d[40],function(a){return d[44]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[34],d[44]).then(function(a){return a=a,d[45]=a[0],d[46]=a[1],a})},function(a){return d[47]=(d[39].push(d[45]),d[39])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[44]=c.createArray(),d[45]=c.i64.of_int32(d[39].length),c.i64.gt(d[45],c.i64.cast([0,0]))?c.loopAsync(d[45],function(a){return d[47]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[39],d[47]).then(function(a){return a=a,d[48]=a[0],d[49]=a[1],a})},function(a){return d[50]=(d[44].push(c.i64.to_string(d[48])),d[44])}])}):c.resolve()},function(a){return d[46]=d[44].join(","),d[41]=d[46]}])},function(a){return d[39].some(function(a){return c.i64.eq(d[30],a)})?d[42]=d[30]:d[42]=void 0,c.i64.neq(d[42],void 0)?d[43]=d[42]:d[43]=void 0,d[20]=d[43]}])},function(e){return c.i64.neq(d[20],void 0)?d[21]=d[20]:d[21]=c.i64.cast([0,0]),c.i64.neq(d[31],void 0)?d[22]=d[31]:d[22]=c.i64.cast([0,1]),c.i64.neq(d[32],void 0)?c.sequence([function(b){return c.i64.neq(a[1],void 0)?c.sequence([function(b){return c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}).next().then(function(e,f){var b=e.done;e=e.value;return b?d[42]=!1:(f=e.item,d[45]=f.deviceId,c.i64.neq(d[45],void 0)?d[44]=c.i64.neq(d[45],a[1]):d[44]=!1,d[42]=d[44])})},function(a){return d[34]=d[42]}]):c.resolve(d[34]=!1)},function(e){return d[34]?c.sequence([function(e){return d[42]=c.createArray(),d[43]=c.i64.of_int32(a[0].length),c.i64.gt(d[43],c.i64.cast([0,0]))?c.loopAsync(d[43],function(e){return d[44]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[0],d[44]).then(function(a){return a=a,d[45]=a[0],d[46]=a[1],a})},function(a){return d[47]=d[45].get("from_epoch"),d[45],d[48]=d[47].get("epoch_anon_id"),d[47],c.nativeOperation(b("LSBase64Encode.nop"),d[48]).then(function(a){return a=a,d[49]=a[0],a})},function(a){return d[49]!==void 0?d[50]=d[49]:d[50]="",d[51]=d[45].get("from_epoch"),d[45],d[52]=d[51].get("epoch_id"),d[51],d[53]=new c.Map(),d[53].set("anon_id",d[50]),d[53].set("epoch_id",d[52]),d[54]=d[45].get("to_epoch"),d[45],d[55]=d[54].get("epoch_anon_id"),d[54],c.nativeOperation(b("LSBase64Encode.nop"),d[55]).then(function(a){return a=a,d[56]=a[0],a})},function(a){return d[56]!==void 0?d[57]=d[56]:d[57]="",d[58]=d[45].get("to_epoch"),d[45],d[59]=d[58].get("epoch_id"),d[58],d[60]=new c.Map(),d[60].set("anon_id",d[57]),d[60].set("epoch_id",d[59]),d[61]=d[45].get("forward_edge"),d[45],d[61]?d[62]=!1:d[62]=!0,d[62]?d[63]=!1:d[63]=!0,d[64]=d[45].get("backward_edge"),d[45],c.blobs.neq(d[64],void 0)?d[65]=!0:d[65]=!1,d[66]=new c.Map(),d[66].set("from",d[53]),d[66].set("to",d[60]),d[66].set("has_forward_edge",d[63]),d[66].set("has_backward_edge",d[65]),d[66].set("result_code",c.i64.cast([0,8])),d[66].set("error_message",void 0),d[67]=(d[42].push(d[66]),d[42])}])}):c.resolve()},function(b){return b=[d[32],d[32],a[1],a[2],c.i64.cast([0,0]),c.i64.cast([0,0]),d[42]],d[35]=b[0],d[36]=b[1],d[37]=b[2],d[38]=b[3],d[39]=b[4],d[40]=b[5],d[41]=b[6],b}]):c.sequence([function(e){return d[42]=c.createArray(),d[43]=c.i64.of_int32(a[0].length),c.i64.gt(d[43],c.i64.cast([0,0]))?c.loopAsync(d[43],function(e){return d[44]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[0],d[44]).then(function(a){return a=a,d[45]=a[0],d[46]=a[1],a})},function(a){return d[47]=d[45].get("from_epoch"),d[45],d[48]=d[47].get("epoch_id"),d[47],c.count(c.db.table(169).fetch([[[d[48]]]])).then(function(a){return d[49]=a})},function(a){return c.i64.le(d[49],c.i64.cast([0,1]))?c.sequence([function(a){return c.db.table(169).fetch([[[d[48]]]]).next().then(function(b,e){var a=b.done;b=b.value;return a?(d[75]=new c.Map(),d[75].set("error_msg","Expected a nonempty query result"),d[75].set("code",c.i64.cast([0,3])),d[75].set("src_line","MEBEpochClientUtils.php:69 MEBEpochClientUtils::maybeEpoch()"),d[76]=c.createArray(),d[77]=(d[76].push(d[75]),d[76]),a=[void 0,d[76]],d[71]=a[0],d[72]=a[1],a):(e=b.item,d[75]=new c.Map(),d[75].set("epoch_id",e.epochId),d[75].set("backup_id",e.backupId),d[75].set("epoch_anon_id_blob",e.epochAnonIdBlob),d[75].set("epoch_root_key_blob",e.epochRootKeyBlob),d[75].set("epoch_status",e.epochStatus),d[75].set("authority_level",e.authorityLevel),a=[d[75],void 0],d[71]=a[0],d[72]=a[1],a)})},function(a){return d[74]=new c.Map(),d[74].set("value",d[71]),d[74].set("errors",d[72]),d[50]=d[74]}]):c.resolve((d[71]=new c.Map(),d[71].set("error_msg","Expected at most one result"),d[71].set("code",c.i64.cast([0,4])),d[71].set("src_line","MEBEpochClientUtils.php:69 MEBEpochClientUtils::maybeEpoch()"),d[72]=c.createArray(),d[74]=(d[72].push(d[71]),d[72]),d[73]=new c.Map(),d[73].set("value",void 0),d[73].set("errors",d[72]),d[50]=d[73]))},function(a){return d[51]=d[50].get("value"),d[50],d[51]!==void 0?(d[71]=d[51].get("epoch_id"),d[51],d[72]=d[51].get("backup_id"),d[51],d[73]=d[51].get("epoch_anon_id_blob"),d[51],d[74]=d[51].get("epoch_root_key_blob"),d[51],d[75]=d[51].get("epoch_status"),d[51],d[76]=d[51].get("authority_level"),d[51],d[52]=d[50]):(d[71]=d[50].get("errors"),d[50],d[72]=d[50].get("errors"),d[50],d[73]=new c.Map(),d[73].set("error_msg","EB_EPOCH_SRC_EPOCH_MISSING"),d[73].set("code",c.i64.cast([0,10003])),d[73].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:372 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processEdge()"),d[75]=(d[71].push(d[73]),d[71]),d[74]=new c.Map(),d[74].set("value",void 0),d[74].set("errors",d[71]),d[52]=d[74]),d[53]=d[52].get("value"),d[52],d[53]!==void 0?(d[71]=d[53].get("epoch_id"),d[53],d[72]=d[53].get("backup_id"),d[53],d[73]=d[53].get("epoch_anon_id_blob"),d[53],d[74]=d[53].get("epoch_root_key_blob"),d[53],d[75]=d[53].get("epoch_status"),d[53],d[76]=d[53].get("authority_level"),d[53],d[77]=d[45].get("from_epoch"),d[45],d[78]=d[77].get("epoch_anon_id"),d[77],c.blobs.eq(d[78],d[73])?d[79]=d[52]:(d[80]=new c.Map(),d[80].set("error_msg","EB_EPOCH_DERIVATION_SRC_ANON_ID_MISMATCH"),d[80].set("code",c.i64.cast([0,10007])),d[80].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:377 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processEdge#2()"),d[81]=c.createArray(),d[83]=(d[81].push(d[80]),d[81]),d[82]=new c.Map(),d[82].set("value",void 0),d[82].set("errors",d[81]),d[79]=d[82]),d[54]=d[79]):(d[71]=d[52].get("errors"),d[52],d[72]=d[52].get("errors"),d[52],d[73]=new c.Map(),d[73].set("value",void 0),d[73].set("errors",d[71]),d[54]=d[73]),d[55]=d[54].get("value"),d[54],d[55]!==void 0?c.sequence([function(a){return d[71]=d[55].get("epoch_id"),d[55],d[72]=d[55].get("backup_id"),d[55],d[73]=d[55].get("epoch_anon_id_blob"),d[55],d[74]=d[55].get("epoch_root_key_blob"),d[55],d[75]=d[55].get("epoch_status"),d[55],d[76]=d[55].get("authority_level"),d[55],d[77]=d[45].get("from_epoch_fingerprint"),d[45],d[78]=c.createArray(),d[83]=(d[78].push(c.i64.cast([0,18])),d[78]),c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,d[74],d[78]).then(function(a){return a=a,d[79]=a[0],a})},function(a){return d[79]!==void 0?c.sequence([function(a){return d[83]=c.i64.of_int32(d[79].length),c.i64.ge(d[83],c.i64.cast([0,1]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[79],c.i64.cast([0,0])).then(function(a){return a=a,d[85]=a[0],d[86]=a[1],a})},function(a){return d[84]=d[85]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),d[85]=c.createArray(),void 0!==void 0?d[86]=(d[85].push(void 0),d[85]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint","CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",d[85],c.i64.cast([0,3]))},function(a){return d[84]=void 0}])},function(a){return d[80]=d[84]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),d[83]=c.createArray(),void 0!==void 0?d[84]=(d[83].push(void 0),d[83]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint","CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",d[83],c.i64.cast([0,3]))},function(a){return d[80]=void 0}])},function(a){return c.blobs.neq(d[80],void 0)?d[81]=!0:d[81]=!1,d[81]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),c["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),c.blobs.eq(d[77],void 0)||c.blobs.eq(d[77],d[80])?d[82]=d[54]:(d[83]=new c.Map(),d[83].set("error_msg","EB_EPOCH_DERIVATION_SRC_FINGERPRINT_MISMATCH"),d[83].set("code",c.i64.cast([0,10002])),d[83].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:386 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processEdge#4()"),d[84]=c.createArray(),d[86]=(d[84].push(d[83]),d[84]),d[85]=new c.Map(),d[85].set("value",void 0),d[85].set("errors",d[84]),d[82]=d[85]),d[56]=d[82]}]):c.resolve((d[71]=d[54].get("errors"),d[54],d[72]=d[54].get("errors"),d[54],d[73]=new c.Map(),d[73].set("value",void 0),d[73].set("errors",d[71]),d[56]=d[73]))},function(a){return d[57]=d[45].get("forward_edge"),d[45],d[57]!==void 0?c.sequence([function(a){return d[71]=d[56].get("value"),d[56],d[71]!==void 0?c.sequence([function(a){return d[85]=d[71].get("epoch_id"),d[71],d[86]=d[71].get("backup_id"),d[71],d[87]=d[71].get("epoch_anon_id_blob"),d[71],d[88]=d[71].get("epoch_root_key_blob"),d[71],d[89]=d[71].get("epoch_status"),d[71],d[90]=d[71].get("authority_level"),d[71],c.nativeOperation(b("LSGetNextEpochAnonId.nop"),d[87]).then(function(a){return a=a,d[91]=a[0],a})},function(a){return d[92]=d[45].get("to_epoch"),d[45],d[93]=d[92].get("epoch_anon_id"),d[92],c.blobs.eq(d[91],d[93])?d[94]=d[56]:(d[95]=new c.Map(),d[95].set("error_msg","EB_EPOCH_FORWARD_EDGE_NOT_CONSECUTIVE"),d[95].set("code",c.i64.cast([0,10009])),d[95].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:104 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processForwardEdge()"),d[96]=c.createArray(),d[98]=(d[96].push(d[95]),d[96]),d[97]=new c.Map(),d[97].set("value",void 0),d[97].set("errors",d[96]),d[94]=d[97]),d[72]=d[94]}]):c.resolve((d[85]=d[56].get("errors"),d[56],d[86]=d[56].get("errors"),d[56],d[87]=new c.Map(),d[87].set("value",void 0),d[87].set("errors",d[85]),d[72]=d[87]))},function(a){return d[73]=d[72].get("value"),d[72],d[73]!==void 0?c.sequence([function(a){return d[85]=d[73].get("epoch_id"),d[73],d[86]=d[73].get("backup_id"),d[73],d[87]=d[73].get("epoch_anon_id_blob"),d[73],d[88]=d[73].get("epoch_root_key_blob"),d[73],d[89]=d[73].get("epoch_status"),d[73],d[90]=d[73].get("authority_level"),d[73],d[91]=d[45].get("from_epoch"),d[45],d[92]=d[91].get("epoch_anon_id"),d[91],d[93]=d[45].get("from_epoch"),d[45],d[94]=d[93].get("epoch_id"),d[93],d[95]=c.createArray(),d[104]=(d[95].push(c.i64.cast([0,32])),d[95]),d[104]=(d[95].push(c.i64.cast([0,32])),d[95]),d[96]="_",c.nativeOperation(b("LSGetBlobFromString.nop"),["epoch_chaining",d[96],c.blobs.to_string(d[92]),d[96],c.i64.to_string(d[94])].join("")).then(function(a){return a=a,d[97]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[97],void 0,d[88],d[95]).then(function(a){return a=a,d[98]=a[0],a})},function(a){return d[98]?d[99]=!1:d[99]=!0,d[99]?c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] Failed to generate epoch_chaining_key and epoch_distribution_pre_shared_key."),d[104]=c.createArray(),void 0!==void 0?d[107]=(d[104].push(void 0),d[104]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils","Failed to generate epoch_chaining_key and epoch_distribution_pre_shared_key.",d[104],c.i64.cast([0,3]))},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),"").then(function(a){return a=a,d[105]=a[0],a})},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),"").then(function(a){return a=a,d[106]=a[0],a})},function(a){return a=[d[105],d[106]],d[100]=a[0],d[101]=a[1],a}]):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[98],c.i64.cast([0,0])).then(function(a){return a=a,d[104]=a[0],d[105]=a[1],a})},function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[98],c.i64.cast([0,1])).then(function(a){return a=a,d[106]=a[0],d[107]=a[1],a})},function(a){return a=[d[104],d[106]],d[100]=a[0],d[101]=a[1],a}])},function(a){return d[102]=new c.Map(),d[102].set("epoch_chaining_key",d[100]),d[102].set("epoch_distribution_pre_shared_key",d[101]),d[103]=new c.Map(),d[103].set("value",d[102]),d[103].set("errors",void 0),d[74]=d[103]}]):c.resolve((d[85]=d[72].get("errors"),d[72],d[86]=d[72].get("errors"),d[72],d[87]=new c.Map(),d[87].set("value",void 0),d[87].set("errors",d[85]),d[74]=d[87]))},function(a){return d[75]=d[74].get("value"),d[74],d[75]!==void 0?c.sequence([function(a){return d[85]=d[75].get("epoch_chaining_key"),d[75],d[86]=d[75].get("epoch_distribution_pre_shared_key"),d[75],d[87]=d[57].get("psk_fingerprint"),d[57],d[88]=c.createArray(),d[93]=(d[88].push(c.i64.cast([0,18])),d[88]),c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkNyeXB0b1ByZVNoYXJlZEtleQ=="),void 0,d[86],d[88]).then(function(a){return a=a,d[89]=a[0],a})},function(a){return d[89]!==void 0?c.sequence([function(a){return d[93]=c.i64.of_int32(d[89].length),c.i64.ge(d[93],c.i64.cast([0,1]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[89],c.i64.cast([0,0])).then(function(a){return a=a,d[95]=a[0],d[96]=a[1],a})},function(a){return d[94]=d[95]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),d[95]=c.createArray(),void 0!==void 0?d[96]=(d[95].push(void 0),d[95]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint","CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",d[95],c.i64.cast([0,3]))},function(a){return d[94]=void 0}])},function(a){return d[90]=d[94]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),d[93]=c.createArray(),void 0!==void 0?d[94]=(d[93].push(void 0),d[93]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint","CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",d[93],c.i64.cast([0,3]))},function(a){return d[90]=void 0}])},function(a){return c.blobs.neq(d[90],void 0)?d[91]=!0:d[91]=!1,d[91]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),c["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),c.blobs.eq(d[87],void 0)||c.blobs.eq(d[87],d[90])?d[92]=d[74]:(d[93]=new c.Map(),d[93].set("error_msg","EB_EPOCH_DERIVATION_PSK_FINGERPRINT_MISMATCH"),d[93].set("code",c.i64.cast([0,10005])),d[93].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:130 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processForwardEdge#4()"),d[94]=c.createArray(),d[96]=(d[94].push(d[93]),d[94]),d[95]=new c.Map(),d[95].set("value",void 0),d[95].set("errors",d[94]),d[92]=d[95]),d[76]=d[92]}]):c.resolve((d[85]=d[74].get("errors"),d[74],d[86]=d[74].get("errors"),d[74],d[87]=new c.Map(),d[87].set("value",void 0),d[87].set("errors",d[85]),d[76]=d[87]))},function(a){return d[77]=d[76].get("value"),d[76],d[77]!==void 0?(d[85]=d[77].get("epoch_chaining_key"),d[77],d[86]=d[77].get("epoch_distribution_pre_shared_key"),d[77],d[87]=d[57].get("epoch_storage_public_key"),d[57],c.blobs.eq(d[87],void 0)||c.blobs.eq(d[87],d[33])?d[88]=d[76]:(d[89]=new c.Map(),d[89].set("error_msg","EB_EPOCH_DERIVATION_STORAGE_KEY_MISMATCH"),d[89].set("code",c.i64.cast([0,10006])),d[89].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:144 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processForwardEdge#7()"),d[90]=c.createArray(),d[92]=(d[90].push(d[89]),d[90]),d[91]=new c.Map(),d[91].set("value",void 0),d[91].set("errors",d[90]),d[88]=d[91]),d[78]=d[88]):(d[85]=d[76].get("errors"),d[76],d[86]=d[76].get("errors"),d[76],d[87]=new c.Map(),d[87].set("value",void 0),d[87].set("errors",d[85]),d[78]=d[87]),d[79]=d[78].get("value"),d[78],d[79]!==void 0?c.sequence([function(a){return d[85]=d[79].get("epoch_chaining_key"),d[79],d[86]=d[79].get("epoch_distribution_pre_shared_key"),d[79],d[87]=d[57].get("auth_public_key"),d[57],d[88]=d[45].get("to_epoch"),d[45],d[89]=d[88].get("epoch_anon_id"),d[88],d[90]=d[57].get("encrypted_entropy"),d[57],c.nativeOperation(b("LSPublicEncryptionCreateDecryptedData.nop"),d[33],f.epochStoragePrivateKeyBlob,d[87],d[86],c.blobs.of_string(["epoch_","_",c.blobs.to_string(d[89])].join("")),d[90]).then(function(a){return a=a,d[91]=a[0],a})},function(a){return c.blobs.neq(d[91],void 0)?c.resolve(d[92]=d[91]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] Couldn't decrypt epoch key. Returning null entropy"),d[98]=c.createArray(),void 0!==void 0?d[99]=(d[98].push(void 0),d[98]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils","Couldn't decrypt epoch key. Returning null entropy",d[98],c.i64.cast([0,3]))},function(a){return d[92]=void 0}])},function(a){return c.blobs.neq(d[92],void 0)?(d[98]=new c.Map(),d[98].set("entropy",d[92]),d[99]=new c.Map(),d[99].set("value",d[98]),d[99].set("errors",void 0),d[100]=d[99].get("value"),d[99],d[101]=d[99].get("errors"),d[99],a=[d[100],d[101]],d[93]=a[0],d[94]=a[1],a):(d[98]=c.createArray(),c.blobs.eq(d[92],void 0)?d[105]=(d[98].push("entropy"),d[98]):0,d[99]=d[98].join(", "),d[100]=new c.Map(),d[100].set("error_msg",["The following required nullables are null: ","",d[99]].join("")),d[100].set("code",c.i64.cast([0,2])),d[100].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:169 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processForwardEdge#11()"),d[101]=c.createArray(),d[105]=(d[101].push(d[100]),d[101]),d[102]=new c.Map(),d[102].set("value",void 0),d[102].set("errors",d[101]),d[103]=d[102].get("value"),d[102],d[104]=d[102].get("errors"),d[102],a=[d[103],d[104]],d[93]=a[0],d[94]=a[1],a),d[95]=new c.Map(),d[95].set("value",d[93]),d[95].set("errors",d[94]),d[96]=d[95].get("value"),d[95],d[96]!==void 0?(d[98]=d[96].get("entropy"),d[96],d[97]=d[95]):(d[98]=d[95].get("errors"),d[95],d[99]=d[95].get("errors"),d[95],d[100]=new c.Map(),d[100].set("error_msg","EB_EPOCH_FORWARD_DECRYPTION_FAILED"),d[100].set("code",c.i64.cast([0,10004])),d[100].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:171 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processForwardEdge#10()"),d[102]=(d[98].push(d[100]),d[98]),d[101]=new c.Map(),d[101].set("value",void 0),d[101].set("errors",d[98]),d[97]=d[101]),d[80]=d[97]}]):c.resolve((d[85]=d[78].get("errors"),d[78],d[86]=d[78].get("errors"),d[78],d[87]=new c.Map(),d[87].set("value",void 0),d[87].set("errors",d[85]),d[80]=d[87]))},function(a){return d[81]=d[78].get("value"),d[78],d[81]!==void 0?c.sequence([function(a){return d[85]=d[81].get("epoch_chaining_key"),d[81],d[86]=d[81].get("epoch_distribution_pre_shared_key"),d[81],d[87]=d[80].get("value"),d[80],d[87]!==void 0?c.sequence([function(a){return d[89]=d[87].get("entropy"),d[87],d[90]=c.createArray(),d[97]=(d[90].push(c.i64.cast([0,32])),d[90]),c.nativeOperation(b("LSGetBlobFromString.nop"),"epoch_root_key").then(function(a){return a=a,d[91]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),d[91],d[85],d[89],d[90]).then(function(a){return a=a,d[92]=a[0],a})},function(a){return d[92]?d[93]=!1:d[93]=!0,d[93]?c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] Unable to generate epoch root key."),d[97]=c.createArray(),void 0!==void 0?d[99]=(d[97].push(void 0),d[97]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils","Unable to generate epoch root key.",d[97],c.i64.cast([0,3]))},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),"").then(function(a){return a=a,d[98]=a[0],a})},function(a){return d[94]=d[98]}]):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[92],c.i64.cast([0,0])).then(function(a){return a=a,d[97]=a[0],d[98]=a[1],a})},function(a){return d[94]=d[97]}])},function(a){return d[95]=new c.Map(),d[95].set("root_key",d[94]),d[96]=new c.Map(),d[96].set("value",d[95]),d[96].set("errors",void 0),d[88]=d[96]}]):c.resolve((d[89]=d[80].get("errors"),d[80],d[90]=d[80].get("errors"),d[80],d[91]=new c.Map(),d[91].set("value",void 0),d[91].set("errors",d[89]),d[88]=d[91]))},function(a){return d[82]=d[88]}]):c.resolve((d[85]=d[78].get("errors"),d[78],d[86]=d[78].get("errors"),d[78],d[87]=new c.Map(),d[87].set("value",void 0),d[87].set("errors",d[85]),d[82]=d[87]))},function(a){return d[83]=d[82].get("value"),d[82],d[84]=d[82].get("errors"),d[82],a=[d[83],d[84]],d[58]=a[0],d[59]=a[1],a}]):c.sequence([function(a){return d[71]=d[45].get("backward_edge"),d[45],c.blobs.neq(d[71],void 0)?c.sequence([function(a){return d[77]=d[56].get("value"),d[56],d[77]!==void 0?c.sequence([function(a){return d[85]=d[77].get("epoch_id"),d[77],d[86]=d[77].get("backup_id"),d[77],d[87]=d[77].get("epoch_anon_id_blob"),d[77],d[88]=d[77].get("epoch_root_key_blob"),d[77],d[89]=d[77].get("epoch_status"),d[77],d[90]=d[77].get("authority_level"),d[77],d[91]=d[45].get("to_epoch"),d[45],d[92]=d[91].get("epoch_anon_id"),d[91],c.nativeOperation(b("LSGetNextEpochAnonId.nop"),d[92]).then(function(a){return a=a,d[93]=a[0],a})},function(a){return c.blobs.eq(d[93],d[87])?d[94]=d[56]:(d[95]=new c.Map(),d[95].set("error_msg","EB_EPOCH_BACKWARD_EDGE_NOT_CONSECUTIVE"),d[95].set("code",c.i64.cast([0,10010])),d[95].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:198 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processBackwardEdge()"),d[96]=c.createArray(),d[98]=(d[96].push(d[95]),d[96]),d[97]=new c.Map(),d[97].set("value",void 0),d[97].set("errors",d[96]),d[94]=d[97]),d[78]=d[94]}]):c.resolve((d[85]=d[56].get("errors"),d[56],d[86]=d[56].get("errors"),d[56],d[87]=new c.Map(),d[87].set("value",void 0),d[87].set("errors",d[85]),d[78]=d[87]))},function(a){return d[79]=d[78].get("value"),d[78],d[79]!==void 0?c.sequence([function(a){return d[85]=d[79].get("epoch_id"),d[79],d[86]=d[79].get("backup_id"),d[79],d[87]=d[79].get("epoch_anon_id_blob"),d[79],d[88]=d[79].get("epoch_root_key_blob"),d[79],d[89]=d[79].get("epoch_status"),d[79],d[90]=d[79].get("authority_level"),d[79],d[91]=c.createArray(),d[96]=(d[91].push(c.i64.cast([0,32])),d[91]),c.nativeOperation(b("LSBase64Encode.nop"),d[87]).then(function(a){return a=a,d[92]=a[0],a})},function(a){return d[92]!==void 0?c.sequence([function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blobs.of_string(["epoch_data_storage","_",d[92]].join("")),void 0,d[88],d[91]).then(function(a){return a=a,d[96]=a[0],a})},function(a){return d[96]?d[97]=!1:d[97]=!0,d[97]?c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish"),d[99]=c.createArray(),void 0!==void 0?d[101]=(d[99].push(void 0),d[99]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils","THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish",d[99],c.i64.cast([0,3]))},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),"").then(function(a){return a=a,d[100]=a[0],a})},function(a){return d[98]=d[100]}]):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[96],c.i64.cast([0,0])).then(function(a){return a=a,d[99]=a[0],d[100]=a[1],a})},function(a){return d[98]=d[99]}])},function(a){return d[93]=d[98]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish"),d[96]=c.createArray(),void 0!==void 0?d[98]=(d[96].push(void 0),d[96]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils","THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish",d[96],c.i64.cast([0,3]))},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),"").then(function(a){return a=a,d[97]=a[0],a})},function(a){return d[93]=d[97]}])},function(a){return d[94]=new c.Map(),d[94].set("epoch_data_storage_key",d[93]),d[95]=new c.Map(),d[95].set("value",d[94]),d[95].set("errors",void 0),d[80]=d[95]}]):c.resolve((d[85]=d[78].get("errors"),d[78],d[86]=d[78].get("errors"),d[78],d[87]=new c.Map(),d[87].set("value",void 0),d[87].set("errors",d[85]),d[80]=d[87]))},function(a){return d[81]=d[80].get("value"),d[80],d[81]!==void 0?c.sequence([function(a){return d[85]=d[81].get("epoch_data_storage_key"),d[81],c.nativeOperation(b("LSBase64Encode.nop"),d[71]).then(function(a){return a=a,d[86]=a[0],a})},function(a){return d[93]=d[86],d[93]!==void 0?c.sequence([function(a){return c.nativeOperation(b("LSSymmetricEncryptionCreateDecryptedString.nop"),d[85],c.blob("ZXBvY2hfZGF0YV9tZXRhZGF0YQ=="),d[93]).then(function(a){return a=a,d[94]=a[0],a})},function(a){return c.nativeOperation(b("LSBase64Decode.nop"),d[94]).then(function(a){return a=a,d[95]=a[0],a})},function(a){return d[87]=d[95]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] Unable to base64 encode backward edge."),d[94]=c.createArray(),void 0!==void 0?d[95]=(d[94].push(void 0),d[94]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils","Unable to base64 encode backward edge.",d[94],c.i64.cast([0,3]))},function(a){return d[87]=void 0}])},function(a){return c.blobs.neq(d[87],void 0)?(d[94]=new c.Map(),d[94].set("root_key",d[87]),d[95]=new c.Map(),d[95].set("value",d[94]),d[95].set("errors",void 0),d[96]=d[95].get("value"),d[95],d[97]=d[95].get("errors"),d[95],a=[d[96],d[97]],d[88]=a[0],d[89]=a[1],a):(d[94]=c.createArray(),c.blobs.eq(d[87],void 0)?d[101]=(d[94].push("root_key"),d[94]):0,d[95]=d[94].join(", "),d[96]=new c.Map(),d[96].set("error_msg",["The following required nullables are null: ","",d[95]].join("")),d[96].set("code",c.i64.cast([0,2])),d[96].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:227 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processBackwardEdge#5()"),d[97]=c.createArray(),d[101]=(d[97].push(d[96]),d[97]),d[98]=new c.Map(),d[98].set("value",void 0),d[98].set("errors",d[97]),d[99]=d[98].get("value"),d[98],d[100]=d[98].get("errors"),d[98],a=[d[99],d[100]],d[88]=a[0],d[89]=a[1],a),d[90]=new c.Map(),d[90].set("value",d[88]),d[90].set("errors",d[89]),d[91]=d[90].get("value"),d[90],d[91]!==void 0?(d[94]=d[91].get("root_key"),d[91],d[92]=d[90]):(d[94]=d[90].get("errors"),d[90],d[95]=d[90].get("errors"),d[90],d[96]=new c.Map(),d[96].set("error_msg","EB_EPOCH_BACKWARD_DECRYPTION_FAILED"),d[96].set("code",c.i64.cast([0,10013])),d[96].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:229 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processBackwardEdge#4()"),d[98]=(d[94].push(d[96]),d[94]),d[97]=new c.Map(),d[97].set("value",void 0),d[97].set("errors",d[94]),d[92]=d[97]),d[82]=d[92]}]):c.resolve((d[85]=d[80].get("errors"),d[80],d[86]=d[80].get("errors"),d[80],d[87]=new c.Map(),d[87].set("value",void 0),d[87].set("errors",d[85]),d[82]=d[87]))},function(a){return d[83]=d[82].get("value"),d[82],d[84]=d[82].get("errors"),d[82],a=[d[83],d[84]],d[72]=a[0],d[73]=a[1],a}]):c.resolve((d[77]=new c.Map(),d[77].set("error_msg","EB_EPOCH_EDGE_NEITHER_FORWARD_NOR_BACKWARD"),d[77].set("code",c.i64.cast([0,10008])),d[77].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:411 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processEdge#9()"),d[78]=c.createArray(),d[82]=(d[78].push(d[77]),d[78]),d[79]=new c.Map(),d[79].set("value",void 0),d[79].set("errors",d[78]),d[80]=d[79].get("value"),d[79],d[81]=d[79].get("errors"),d[79],a=[d[80],d[81]],d[72]=a[0],d[73]=a[1],a))},function(a){return d[74]=new c.Map(),d[74].set("value",d[72]),d[74].set("errors",d[73]),d[75]=d[74].get("value"),d[74],d[76]=d[74].get("errors"),d[74],a=[d[75],d[76]],d[58]=a[0],d[59]=a[1],a}])},function(a){return d[60]=new c.Map(),d[60].set("value",d[58]),d[60].set("errors",d[59]),d[61]=d[60].get("value"),d[60],d[61]!==void 0?c.sequence([function(a){return d[71]=d[61].get("root_key"),d[61],d[72]=d[45].get("to_epoch_fingerprint"),d[45],d[73]=c.createArray(),d[78]=(d[73].push(c.i64.cast([0,18])),d[73]),c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,d[71],d[73]).then(function(a){return a=a,d[74]=a[0],a})},function(a){return d[74]!==void 0?c.sequence([function(a){return d[78]=c.i64.of_int32(d[74].length),c.i64.ge(d[78],c.i64.cast([0,1]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[74],c.i64.cast([0,0])).then(function(a){return a=a,d[80]=a[0],d[81]=a[1],a})},function(a){return d[79]=d[80]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),d[80]=c.createArray(),void 0!==void 0?d[81]=(d[80].push(void 0),d[80]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint","CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",d[80],c.i64.cast([0,3]))},function(a){return d[79]=void 0}])},function(a){return d[75]=d[79]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),d[78]=c.createArray(),void 0!==void 0?d[79]=(d[78].push(void 0),d[78]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint","CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",d[78],c.i64.cast([0,3]))},function(a){return d[75]=void 0}])},function(a){return c.blobs.neq(d[75],void 0)?d[76]=!0:d[76]=!1,d[76]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),c["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),c.blobs.eq(d[72],void 0)||c.blobs.eq(d[72],d[75])?d[77]=d[60]:(d[78]=new c.Map(),d[78].set("error_msg","EB_EPOCH_DERIVATION_DEST_FINGERPRINT_MISMATCH"),d[78].set("code",c.i64.cast([0,10001])),d[78].set("src_line","LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure.php:415 Closure$LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure::processEdge#11()"),d[79]=c.createArray(),d[81]=(d[79].push(d[78]),d[79]),d[80]=new c.Map(),d[80].set("value",void 0),d[80].set("errors",d[79]),d[77]=d[80]),d[62]=d[77]}]):c.resolve((d[71]=d[60].get("errors"),d[60],d[72]=d[60].get("errors"),d[60],d[73]=new c.Map(),d[73].set("value",void 0),d[73].set("errors",d[71]),d[62]=d[73]))},function(a){return d[63]=d[62].get("value"),d[62],d[63]!==void 0?c.sequence([function(a){return d[71]=d[63].get("root_key"),d[63],d[72]=d[45].get("to_epoch"),d[45],d[73]=d[72].get("epoch_id"),d[72],d[74]=d[45].get("to_epoch"),d[45],d[75]=d[74].get("epoch_anon_id"),d[74],d[96]="Storing newly derived epoch ",d[97]=c.blobs.to_string(d[75]),d[98]=" authority_level:",d[99]="AUTHORITATIVE",d[100]=" status:",d[101]=c.i64.to_string(c.i64.cast([0,2])),d[76]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBEpochClientUtils] ",d[76],d[96],d[76],d[97],d[76],d[98],d[76],d[99],d[76],d[100],d[76],d[101]].join("")),c.resolve()},function(a){return c.filter(c.db.table(169).fetch([[[d[73]]]]),function(a){return c.i64.eq(a.epochId,d[73])&&c.i64.gt(a.authorityLevel,c.i64.cast([0,80]))}).next().then(function(b){var a=b.done;b.value;return a?c.db.table(169).put({epochId:d[73],backupId:f.backupId,epochAnonIdBlob:d[75],epochRootKeyBlob:d[71],epochStatus:c.i64.cast([0,2]),authorityLevel:c.i64.cast([0,80])}):0})},function(a){return d[77]=d[45].get("from_epoch"),d[45],d[78]=d[77].get("epoch_anon_id"),d[77],c.nativeOperation(b("LSBase64Encode.nop"),d[78]).then(function(a){return a=a,d[79]=a[0],a})},function(a){return d[79]!==void 0?d[80]=d[79]:d[80]="",d[81]=d[45].get("from_epoch"),d[45],d[82]=d[81].get("epoch_id"),d[81],d[83]=new c.Map(),d[83].set("anon_id",d[80]),d[83].set("epoch_id",d[82]),d[84]=d[45].get("to_epoch"),d[45],d[85]=d[84].get("epoch_anon_id"),d[84],c.nativeOperation(b("LSBase64Encode.nop"),d[85]).then(function(a){return a=a,d[86]=a[0],a})},function(a){return d[86]!==void 0?d[87]=d[86]:d[87]="",d[88]=d[45].get("to_epoch"),d[45],d[89]=d[88].get("epoch_id"),d[88],d[90]=new c.Map(),d[90].set("anon_id",d[87]),d[90].set("epoch_id",d[89]),d[91]=d[45].get("forward_edge"),d[45],d[91]?d[92]=!1:d[92]=!0,d[92]?d[93]=!1:d[93]=!0,d[94]=d[45].get("backward_edge"),d[45],c.blobs.neq(d[94],void 0)?d[95]=!0:d[95]=!1,a=[d[83],d[90],d[93],d[95],void 0,c.i64.cast([0,0])],d[64]=a[0],d[65]=a[1],d[66]=a[2],d[67]=a[3],d[68]=a[4],d[69]=a[5],a}]):c.sequence([function(a){return d[71]=d[62].get("errors"),d[62],d[72]=d[62].get("errors"),d[62],d[73]=c.i64.of_int32(d[71].length),c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[71],c.i64.sub(d[73],c.i64.cast([0,1]))).then(function(a){return a=a,d[74]=a[0],d[75]=a[1],a})},function(a){return d[76]=d[74].get("code"),d[74],d[77]=d[74].get("src_line"),d[74],d[78]=d[74].get("error_msg"),d[74],c.i64.eq(d[76],c.i64.cast([0,10004]))?d[79]=c.i64.cast([0,3]):(c.i64.eq(d[76],c.i64.cast([0,10003]))?d[101]=c.i64.cast([0,13]):(c.i64.eq(d[76],c.i64.cast([0,10002]))?d[102]=c.i64.cast([0,9]):(c.i64.eq(d[76],c.i64.cast([0,10001]))?d[103]=c.i64.cast([0,10]):(c.i64.eq(d[76],c.i64.cast([0,10005]))?d[104]=c.i64.cast([0,12]):(c.i64.eq(d[76],c.i64.cast([0,10006]))?d[105]=c.i64.cast([0,11]):(c.i64.eq(d[76],c.i64.cast([0,10008]))?d[106]=c.i64.cast([0,2]):(c.i64.eq(d[76],c.i64.cast([0,10009]))?d[107]=c.i64.cast([0,14]):(c.i64.eq(d[76],c.i64.cast([0,10010]))?d[108]=c.i64.cast([0,15]):(c.i64.eq(d[76],c.i64.cast([0,10011]))?d[109]=c.i64.cast([0,16]):(c.i64.eq(d[76],c.i64.cast([0,10012]))?d[110]=c.i64.cast([0,17]):(c.i64.eq(d[76],c.i64.cast([0,10013]))?d[111]=c.i64.cast([0,6]):d[111]=c.i64.cast([0,1]),d[110]=d[111]),d[109]=d[110]),d[108]=d[109]),d[107]=d[108]),d[106]=d[107]),d[105]=d[106]),d[104]=d[105]),d[103]=d[104]),d[102]=d[103]),d[101]=d[102]),d[79]=d[101]),d[80]=d[45].get("from_epoch"),d[45],d[81]=d[80].get("epoch_anon_id"),d[80],c.nativeOperation(b("LSBase64Encode.nop"),d[81]).then(function(a){return a=a,d[82]=a[0],a})},function(a){return d[82]!==void 0?d[83]=d[82]:d[83]="",d[84]=d[45].get("from_epoch"),d[45],d[85]=d[84].get("epoch_id"),d[84],d[86]=new c.Map(),d[86].set("anon_id",d[83]),d[86].set("epoch_id",d[85]),d[87]=d[45].get("to_epoch"),d[45],d[88]=d[87].get("epoch_anon_id"),d[87],c.nativeOperation(b("LSBase64Encode.nop"),d[88]).then(function(a){return a=a,d[89]=a[0],a})},function(a){return d[89]!==void 0?d[90]=d[89]:d[90]="",d[91]=d[45].get("to_epoch"),d[45],d[92]=d[91].get("epoch_id"),d[91],d[93]=new c.Map(),d[93].set("anon_id",d[90]),d[93].set("epoch_id",d[92]),d[94]=d[45].get("forward_edge"),d[45],d[94]?d[95]=!1:d[95]=!0,d[95]?d[96]=!1:d[96]=!0,d[97]=d[45].get("backward_edge"),d[45],c.blobs.neq(d[97],void 0)?d[98]=!0:d[98]=!1,d[99]="",d[100]=c.i64.of_int32(d[71].length),c.i64.gt(d[100],c.i64.cast([0,0]))?c.loopAsync(d[100],function(a){return d[101]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[71],d[101]).then(function(a){return a=a,d[102]=a[0],d[103]=a[1],a})},function(a){return d[104]=d[102].get("code"),d[102],d[105]=d[102].get("src_line"),d[102],d[106]=d[102].get("error_msg"),d[102],d[107]=d[102].get("code"),d[102],d[108]=d[102].get("src_line"),d[102],d[109]=d[102].get("error_msg"),d[102],d[110]=d[102].get("code"),d[102],d[111]=d[102].get("src_line"),d[102],d[112]=d[102].get("error_msg"),d[102],d[99]=[d[99],["at ",d[105],": ","error code ",c.i64.to_string(d[107]),": ",d[112]].join(""),"\n"].join("")}])}):c.resolve()},function(a){return a=[d[86],d[93],d[96],d[98],d[99],d[79]],d[64]=a[0],d[65]=a[1],d[66]=a[2],d[67]=a[3],d[68]=a[4],d[69]=a[5],a}])},function(a){return d[70]=new c.Map(),d[70].set("from",d[64]),d[70].set("to",d[65]),d[70].set("has_forward_edge",d[66]),d[70].set("has_backward_edge",d[67]),d[70].set("error_message",d[68]),d[70].set("result_code",d[69]),d[71]=(d[42].push(d[70]),d[42])}])}):c.resolve()},function(b){return b=[d[32],d[32],a[1],a[2],c.i64.cast([0,0]),c.i64.cast([0,0]),d[42]],d[35]=b[0],d[36]=b[1],d[37]=b[2],d[38]=b[3],d[39]=b[4],d[40]=b[5],d[41]=b[6],b}])},function(a){return a=[d[35],d[36],d[37],d[38],d[39],d[40],d[41]],d[23]=a[0],d[24]=a[1],d[25]=a[2],d[26]=a[3],d[27]=a[4],d[28]=a[5],d[29]=a[6],a}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure] Unable to load client state: 24"),d[34]=c.createArray(),void 0!==void 0?d[37]=(d[34].push(void 0),d[34]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure","Unable to load client state: 24",d[34],c.i64.cast([0,3]))},function(e){return d[35]=c.createArray(),d[36]=c.i64.of_int32(a[0].length),c.i64.gt(d[36],c.i64.cast([0,0]))?c.loopAsync(d[36],function(e){return d[37]=e,c.sequence([function(e){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),a[0],d[37]).then(function(a){return a=a,d[38]=a[0],d[39]=a[1],a})},function(a){return d[40]=d[38].get("from_epoch"),d[38],d[41]=d[40].get("epoch_anon_id"),d[40],c.nativeOperation(b("LSBase64Encode.nop"),d[41]).then(function(a){return a=a,d[42]=a[0],a})},function(a){return d[42]!==void 0?d[43]=d[42]:d[43]="",d[44]=d[38].get("from_epoch"),d[38],d[45]=d[44].get("epoch_id"),d[44],d[46]=new c.Map(),d[46].set("anon_id",d[43]),d[46].set("epoch_id",d[45]),d[47]=d[38].get("to_epoch"),d[38],d[48]=d[47].get("epoch_anon_id"),d[47],c.nativeOperation(b("LSBase64Encode.nop"),d[48]).then(function(a){return a=a,d[49]=a[0],a})},function(a){return d[49]!==void 0?d[50]=d[49]:d[50]="",d[51]=d[38].get("to_epoch"),d[38],d[52]=d[51].get("epoch_id"),d[51],d[53]=new c.Map(),d[53].set("anon_id",d[50]),d[53].set("epoch_id",d[52]),d[54]=d[38].get("forward_edge"),d[38],d[54]?d[55]=!1:d[55]=!0,d[55]?d[56]=!1:d[56]=!0,d[57]=d[38].get("backward_edge"),d[38],c.blobs.neq(d[57],void 0)?d[58]=!0:d[58]=!1,d[59]=new c.Map(),d[59].set("from",d[46]),d[59].set("to",d[53]),d[59].set("has_forward_edge",d[56]),d[59].set("has_backward_edge",d[58]),d[59].set("result_code",c.i64.cast([0,7])),d[59].set("error_message",void 0),d[60]=(d[35].push(d[59]),d[35])}])}):c.resolve()},function(b){return b=[void 0,void 0,void 0,a[2],c.i64.cast([0,0]),c.i64.cast([0,0]),d[35]],d[23]=b[0],d[24]=b[1],d[25]=b[2],d[26]=b[3],d[27]=b[4],d[28]=b[5],d[29]=b[6],b}])},function(a){return a=[d[23],d[24],d[25],d[26],d[27],d[28],d[29]],d[9]=a[0],d[10]=a[1],d[11]=a[2],d[12]=a[3],d[13]=a[4],d[14]=a[5],d[15]=a[6],a}]))})},function(a){return d[17]=c.i64.of_float(Date.now()),d[18]=new c.Map(),d[18].set("local_device_id",d[9]),d[18].set("decryption_device_id",d[10]),d[18].set("target_device_id",d[11]),d[18].set("epoch_sync_reason",d[12]),d[18].set("start_ms",d[8]),d[18].set("end_ms",d[17]),d[18].set("results",d[15]),d[19]=c.toJSON(d[18]),c.storedProcedure(b("LSIssueNewTask"),"meb_record_epoch_sync",c.i64.cast([0,50039]),d[19],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}]):c.resolve()},function(a){return d[2]=c.i64.of_float(Date.now()),d[3]=c.i64.random(),d[5]="Finishing execution. Execution time: ",d[6]=c.i64.to_string(c.i64.sub(d[2],d[0])),d[7]=" ms",d[4]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure] ",d[4],d[5],d[4],d[6],d[4],d[7]].join("")),c.i64.eq(c.i64.mod_(d[3],c.i64.cast([0,100])),c.i64.cast([0,0]))?(d[8]=",",d[9]=c.createArray(),void 0!==void 0?d[10]=(d[9].push(void 0),d[9]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsDeriveAndStoreEpochsStoredProcedure",[d[5],d[8],d[6],d[8],d[7]].join(""),d[9],c.i64.cast([0,4]))):c.resolve()}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSDeriveOnboardingMaterial",["LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDerivedKeys.nop","LSDeriveAndStoreEpochs","LSGetBlobFromString.nop","LSGetLatestEpochKeys","LSHmac_v2.nop","LSLogMebClientEvent.nop","LSOcmfClientEvolve_v2.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][deriveOnboardingMaterial] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.storedProcedure(b("LSDeriveAndStoreEpochs"),a[3],void 0,c.i64.cast([0,9]),void 0)},function(a){return c.storedProcedure(b("LSGetLatestEpochKeys"),!1).then(function(a){return a=a,d[2]=a[0],d[3]=a[1],a})},function(e){return d[2]!==void 0?c.sequence([function(a){return d[12]=d[2].get("epoch_keys"),d[2],d[13]=d[12].get("epoch_anon_id"),d[12],d[14]=d[12].get("epoch_root_key"),d[12],d[15]=c.createArray(),d[21]=(d[15].push(c.i64.cast([0,32])),d[15]),c.nativeOperation(b("LSBase64Encode.nop"),d[13]).then(function(a){return a=a,d[16]=a[0],a})},function(a){return d[16]!==void 0?c.sequence([function(a){return c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blobs.of_string(["epoch_devices","_",d[16]].join("")),void 0,d[14],d[15]).then(function(a){return a=a,d[21]=a[0],a})},function(a){return d[21]?d[22]=!1:d[22]=!0,d[22]?c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish"),d[24]=c.createArray(),void 0!==void 0?d[26]=(d[24].push(void 0),d[24]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils","THIS IS NOT EXPECTED. Found null keys while deriving keys for epoch. Returning empty blobish",d[24],c.i64.cast([0,3]))},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),"").then(function(a){return a=a,d[25]=a[0],a})},function(a){return d[23]=d[25]}]):c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[21],c.i64.cast([0,0])).then(function(a){return a=a,d[24]=a[0],d[25]=a[1],a})},function(a){return d[23]=d[24]}])},function(a){return d[17]=d[23]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoEpochUtils] THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish"),d[21]=c.createArray(),void 0!==void 0?d[23]=(d[21].push(void 0),d[21]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoEpochUtils","THIS IS NOT EXPECTED. Failed to base64 encode epoch anon id. Returning empty blobish",d[21],c.i64.cast([0,3]))},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),"").then(function(a){return a=a,d[22]=a[0],a})},function(a){return d[17]=d[22]}])},function(e){return c.nativeOperation(b("LSHmac_v2.nop"),d[17],a[0]).then(function(a){return a=a,d[18]=a[0],a})},function(e){return c.blobs.neq(d[18],void 0)?c.sequence([function(e){return c.nativeOperation(b("LSOcmfClientEvolve_v2.nop"),a[2]).then(function(a){return a=a,d[21]=a[0],d[22]=a[1],a})},function(a){return d[23]=new c.Map(),d[23].set("epoch_keys",d[12]),d[23].set("new_ocmf_client_state",d[21]),d[23].set("ocmf_rotation_token",d[22]),d[23].set("device_epoch_hmac",d[18]),a=[d[23],void 0],d[19]=a[0],d[20]=a[1],a}]):c.resolve((d[21]=new c.Map(),d[21].set("error_code",c.i64.cast([0,605])),d[21].set("stored_procedure","LSEncryptedBackupsDeriveOnboardingMaterialStoredProcedure"),d[21].set("error_message",""),e=[void 0,d[21]],d[19]=e[0],d[20]=e[1],e))},function(a){return a=[d[19],d[20]],d[4]=a[0],d[5]=a[1],a}]):c.resolve((e=[void 0,d[3]],d[4]=e[0],d[5]=e[1],e))},function(a){return d[6]=c.i64.of_float(Date.now()),d[7]=c.i64.random(),d[9]="Finishing execution. Execution time: ",d[10]=c.i64.to_string(c.i64.sub(d[6],d[0])),d[11]=" ms",d[8]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][deriveOnboardingMaterial] ",d[8],d[9],d[8],d[10],d[8],d[11]].join("")),c.i64.eq(c.i64.mod_(d[7],c.i64.cast([0,100])),c.i64.cast([0,0]))?(d[12]=",",d[13]=c.createArray(),void 0!==void 0?d[14]=(d[13].push(void 0),d[13]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"deriveOnboardingMaterial",[d[9],d[12],d[10],d[12],d[11]].join(""),d[13],c.i64.cast([0,4]))):c.resolve()},function(a){return a=[d[4],d[5]],e[0]=a[0],e[1]=a[1],a}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSOnboardFromExistingDeviceRegister",["LSArrayGetObjectAt","LSBase64Encode.nop","LSCreateDebugToken.nop","LSCreateDerivedKeys.nop","LSCreateSignatureWithArmadilloKey.nop","LSCreateSignature_v2.nop","LSDeleteBackupOnClient","LSDeriveOnboardingMaterial","LSGenerateLocalKeys","LSGetArmadilloPublicKey.nop","LSGetBlobFromString.nop","LSIsEncryptionVersionSecure","LSIssueNewTask","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(f){return c.sequence([function(e){return d[0]=c.i64.of_float(Date.now()),function(a){c.logger(a).info(a)}("[EncryptedBackups][onboardFromExistingDeviceRegister] Beginning execution."),d[1]=c.i64.of_float(Date.now()),c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))||!1}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(e,f){var g=e.done;e=e.value;return g?c.sequence([function(a){return d[10]=new c.Map(),d[10].set("error_code",c.i64.cast([0,1])),d[10].set("stored_procedure","onboardFromExistingDeviceRegister"),d[10].set("error_message","Client state table fetch error"),d[11]=new c.Map(),d[11].set("failure",d[10]),d[12]=c.toJSON(d[11]),c.storedProcedure(b("LSIssueNewTask"),"meb_onboard_from_existing_device",c.i64.cast([0,50037]),d[12],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))},function(a){return d[13]=new c.Map(),d[13].set("error_code",c.i64.cast([0,1])),d[13].set("stored_procedure","LSEncryptedBackupsOnboardFromExistingDeviceRegisterStoredProcedure"),d[13].set("error_message",""),d[2]=d[13]}]):(f=e.item,c.sequence([function(a){return d[17]=f.backupId,d[16]=f.mailboxRootKeyBlob,d[15]=f.backupTenancy,d[14]=f.encryptionVersion,c.i64.neq(void 0,void 0)?c.resolve(d[10]=void 0):c.sequence([function(a){return d[18]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[19]=a[0],a})},function(a){return d[19]?d[28]=(d[18].push(c.i64.cast([0,0])),d[18]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[20]=a[0],a})},function(a){return d[20]?d[28]=(d[18].push(c.i64.cast([0,2])),d[18]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[21]=a[0],a})},function(a){return d[21]?d[28]=(d[18].push(c.i64.cast([0,3])),d[18]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[22]=a[0],a})},function(a){return d[22]?d[28]=(d[18].push(c.i64.cast([0,4])),d[18]):0,d[23]=c.createArray(),d[24]=c.i64.of_int32(d[18].length),c.i64.gt(d[24],c.i64.cast([0,0]))?c.loopAsync(d[24],function(a){return d[28]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[18],d[28]).then(function(a){return a=a,d[29]=a[0],d[30]=a[1],a})},function(a){return d[31]=(d[23].push(d[29]),d[23])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[28]=c.createArray(),d[29]=c.i64.of_int32(d[23].length),c.i64.gt(d[29],c.i64.cast([0,0]))?c.loopAsync(d[29],function(a){return d[31]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[23],d[31]).then(function(a){return a=a,d[32]=a[0],d[33]=a[1],a})},function(a){return d[34]=(d[28].push(c.i64.to_string(d[32])),d[28])}])}):c.resolve()},function(a){return d[30]=d[28].join(","),d[25]=d[30]}])},function(a){return d[23].some(function(a){return c.i64.eq(d[14],a)})?d[26]=d[14]:d[26]=void 0,c.i64.neq(d[26],void 0)?d[27]=d[26]:d[27]=void 0,d[10]=d[27]}])},function(e){return c.i64.neq(d[10],void 0)?d[11]=d[10]:d[11]=c.i64.cast([0,0]),c.i64.neq(d[15],void 0)?d[12]=d[15]:d[12]=c.i64.cast([0,1]),c.i64.neq(f.deviceId,void 0)?c.sequence([function(e){return c.db.table(185).fetch([[[c.i64.cast([0,1])]]]).next().then(function(h,i){var e=h.done;h=h.value;return e?c.sequence([function(a){return d[20]=new c.Map(),d[20].set("error_code",c.i64.cast([0,18])),d[20].set("stored_procedure","onboardFromExistingDeviceRegister"),d[20].set("error_message","Device metadata fetch error"),d[21]=new c.Map(),d[21].set("failure",d[20]),d[22]=c.toJSON(d[21]),c.storedProcedure(b("LSIssueNewTask"),"meb_onboard_from_existing_device",c.i64.cast([0,50037]),d[22],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))},function(a){return d[23]=new c.Map(),d[23].set("error_code",c.i64.cast([0,18])),d[23].set("stored_procedure","LSEncryptedBackupsOnboardFromExistingDeviceRegisterStoredProcedure"),d[23].set("error_message",""),d[18]=d[23]}]):(i=h.item,c.sequence([function(a){return c.storedProcedure(b("LSGenerateLocalKeys"),!1).then(function(a){return a=a,d[20]=a[0],d[21]=a[1],a})},function(e){return d[20]!==void 0?c.sequence([function(e){return d[23]=d[20].get("device_key"),d[20],d[24]=d[20].get("epoch_storage_key"),d[20],d[25]=d[20].get("epoch_auth_key"),d[20],d[26]=d[23].get("device_public_key"),d[23],c.storedProcedure(b("LSDeriveOnboardingMaterial"),d[26],d[24],f.ocmfClientStateBlob,a[1]).then(function(a){return a=a,d[27]=a[0],d[28]=a[1],a})},function(e){return d[27]!==void 0?c.sequence([function(a){return d[30]=d[27].get("epoch_keys"),d[27],d[31]=d[27].get("new_ocmf_client_state"),d[27],d[32]=d[23].get("device_public_key"),d[23],c.nativeOperation(b("LSBase64Encode.nop"),d[32]).then(function(a){return a=a,d[33]=a[0],a})},function(a){return d[34]=d[27].get("device_epoch_hmac"),d[27],c.nativeOperation(b("LSBase64Encode.nop"),d[34]).then(function(a){return a=a,d[35]=a[0],a})},function(a){return d[36]=d[27].get("epoch_keys"),d[27],d[37]=d[36].get("epoch_root_key"),d[36],c.blobs.neq(d[37],void 0)?c.sequence([function(a){return d[113]=c.createArray(),d[119]=(d[113].push(c.i64.cast([0,18])),d[113]),c.nativeOperation(b("LSCreateDerivedKeys.nop"),c.blob("bWViL2RlYnVnL2ZpbmdlcnByaW50L01FQkVwb2NoUm9vdEtleQ=="),void 0,d[37],d[113]).then(function(a){return a=a,d[114]=a[0],a})},function(a){return d[114]!==void 0?c.sequence([function(a){return d[119]=c.i64.of_int32(d[114].length),c.i64.ge(d[119],c.i64.cast([0,1]))?c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[114],c.i64.cast([0,0])).then(function(a){return a=a,d[121]=a[0],d[122]=a[1],a})},function(a){return d[120]=d[121]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM."),d[121]=c.createArray(),void 0!==void 0?d[122]=(d[121].push(void 0),d[121]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint","CreateDerivedKeys returned an empty list of keys. This should never happen; aborting dasm VM.",d[121],c.i64.cast([0,3]))},function(a){return d[120]=void 0}])},function(a){return d[115]=d[120]}]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBFingerprint] CreateDerivedKeys returned null. This should never happen; aborting dasm VM."),d[119]=c.createArray(),void 0!==void 0?d[120]=(d[119].push(void 0),d[119]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBFingerprint","CreateDerivedKeys returned null. This should never happen; aborting dasm VM.",d[119],c.i64.cast([0,3]))},function(a){return d[115]=void 0}])},function(a){return c.blobs.neq(d[115],void 0)?d[116]=!0:d[116]=!1,d[116]?0:(function(a){c.logger(a).mustfix(a)}("LS::assert is failed. Attempting to coerce a null value to nonnull."),c["throw"]("LS::assert is failed. Attempting to coerce a null value to nonnull.")),c.nativeOperation(b("LSBase64Encode.nop"),d[115]).then(function(a){return a=a,d[117]=a[0],a})},function(a){return d[117]!==void 0?d[118]=d[117]:d[118]="encodingfailed",d[38]=d[118]}]):c.resolve(d[38]="null")},function(a){return d[39]=d[24].get("epoch_storage_public_key"),d[24],c.nativeOperation(b("LSBase64Encode.nop"),d[39]).then(function(a){return a=a,d[40]=a[0],a})},function(a){return d[41]=d[20].get("epoch_storage_public_key_sig"),d[20],c.nativeOperation(b("LSBase64Encode.nop"),d[41]).then(function(a){return a=a,d[42]=a[0],a})},function(a){return d[43]=d[25].get("epoch_auth_public_key"),d[25],c.nativeOperation(b("LSBase64Encode.nop"),d[43]).then(function(a){return a=a,d[44]=a[0],a})},function(a){return d[45]=d[20].get("epoch_auth_public_key_sig"),d[20],c.nativeOperation(b("LSBase64Encode.nop"),d[45]).then(function(a){return a=a,d[46]=a[0],a})},function(a){return d[47]=d[27].get("ocmf_rotation_token"),d[27],c.nativeOperation(b("LSBase64Encode.nop"),d[47]).then(function(a){return a=a,d[48]=a[0],a})},function(a){return d[49]=d[23].get("device_private_key"),d[23],d[50]=d[24].get("epoch_storage_private_key"),d[24],c.blobs.neq(d[16],void 0)?c.sequence([function(a){return d[113]=new c.Map(),c.nativeOperation(b("LSCreateDebugToken.nop"),d[16],"private_key",d[49],c.i64.cast([0,1]),d[113]).then(function(a){return a=a,d[114]=a[0],a})},function(a){return c.blobs.neq(d[114],void 0)?d[115]=d[114]:d[115]=void 0,d[51]=d[115]}]):c.resolve(d[51]=void 0)},function(a){return c.blobs.neq(d[51],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[51]).then(function(a){return a=a,d[113]=a[0],a})},function(a){return d[52]=d[113]}]):c.resolve(d[52]=void 0)},function(a){return c.blobs.neq(d[16],void 0)?c.sequence([function(a){return d[113]=new c.Map(),c.nativeOperation(b("LSCreateDebugToken.nop"),d[16],"ocmf_client_state",d[31],c.i64.cast([0,1]),d[113]).then(function(a){return a=a,d[114]=a[0],a})},function(a){return c.blobs.neq(d[114],void 0)?d[115]=d[114]:d[115]=void 0,d[53]=d[115]}]):c.resolve(d[53]=void 0)},function(a){return c.blobs.neq(d[53],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[53]).then(function(a){return a=a,d[113]=a[0],a})},function(a){return d[54]=d[113]}]):c.resolve(d[54]=void 0)},function(a){return c.blobs.neq(d[16],void 0)?c.sequence([function(a){return d[113]=new c.Map(),c.nativeOperation(b("LSCreateDebugToken.nop"),d[16],"epoch_storage_private_key",d[50],c.i64.cast([0,1]),d[113]).then(function(a){return a=a,d[114]=a[0],a})},function(a){return c.blobs.neq(d[114],void 0)?d[115]=d[114]:d[115]=void 0,d[55]=d[115]}]):c.resolve(d[55]=void 0)},function(a){return c.blobs.neq(d[55],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[55]).then(function(a){return a=a,d[113]=a[0],a})},function(a){return d[56]=d[113]}]):c.resolve(d[56]=void 0)},function(a){return c.db.table(168).fetch().next().then(function(d,e){var a=d.done;d=d.value;return a?0:(e=d.item,c.storedProcedure(b("LSDeleteBackupOnClient"),e.backupId,void 0,!1,void 0,"null",!0))})},function(a){return d[57]=d[23].get("device_public_key"),d[23],d[58]=d[23].get("device_private_key"),d[23],d[59]=d[24].get("epoch_storage_public_key"),d[24],d[60]=d[24].get("epoch_storage_private_key"),d[24],d[61]=d[25].get("epoch_auth_public_key"),d[25],d[62]=d[25].get("epoch_auth_private_key"),d[25],c.forEach(c.filter(c.db.table(168).fetch([[[d[17]]]]),function(a){return c.i64.eq(a.backupId,d[17])&&c.i64.lt(a.authorityLevel,c.i64.cast([0,20]))}),function(a){return a["delete"]()})},function(b){return c.db.table(168).add({backupId:d[17],deviceId:a[0],devicePublicKeyBlob:d[57],devicePrivateKeyBlob:d[58],epochStoragePublicKeyBlob:d[59],epochStoragePrivateKeyBlob:d[60],epochAuthPublicKeyBlob:d[61],epochAuthPrivateKeyBlob:d[62],mailboxRootKeyBlob:d[16],ocmfClientStateBlob:d[31],obliviousValidationTokenBlob:f.obliviousValidationTokenBlob,authorityLevel:c.i64.cast([0,20]),backupTenancy:c.i64.cast([0,1])})},function(a){return c.blobs.neq(d[16],void 0)?c.sequence([function(a){return d[113]=new c.Map(),c.nativeOperation(b("LSCreateDebugToken.nop"),d[16],"private_key",d[58],c.i64.cast([0,1]),d[113]).then(function(a){return a=a,d[114]=a[0],a})},function(a){return c.blobs.neq(d[114],void 0)?d[115]=d[114]:d[115]=void 0,d[63]=d[115]}]):c.resolve(d[63]=void 0)},function(a){return c.blobs.neq(d[63],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[63]).then(function(a){return a=a,d[113]=a[0],a})},function(a){return d[64]=d[113]}]):c.resolve(d[64]=void 0)},function(a){return c.blobs.neq(d[16],void 0)?c.sequence([function(a){return d[113]=new c.Map(),c.nativeOperation(b("LSCreateDebugToken.nop"),d[16],"epoch_storage_private_key",d[60],c.i64.cast([0,1]),d[113]).then(function(a){return a=a,d[114]=a[0],a})},function(a){return c.blobs.neq(d[114],void 0)?d[115]=d[114]:d[115]=void 0,d[65]=d[115]}]):c.resolve(d[65]=void 0)},function(a){return c.blobs.neq(d[65],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[65]).then(function(a){return a=a,d[113]=a[0],a})},function(a){return d[66]=d[113]}]):c.resolve(d[66]=void 0)},function(a){return c.blobs.neq(d[16],void 0)?c.sequence([function(a){return d[113]=new c.Map(),c.nativeOperation(b("LSCreateDebugToken.nop"),d[16],"epoch_auth_private_key",d[62],c.i64.cast([0,1]),d[113]).then(function(a){return a=a,d[114]=a[0],a})},function(a){return c.blobs.neq(d[114],void 0)?d[115]=d[114]:d[115]=void 0,d[67]=d[115]}]):c.resolve(d[67]=void 0)},function(a){return c.blobs.neq(d[67],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[67]).then(function(a){return a=a,d[113]=a[0],a})},function(a){return d[68]=d[113]}]):c.resolve(d[68]=void 0)},function(a){return d[112]=c.blob("bWFpbGJveF9yb290X2tleQ=="),c.blobs.neq(d[112],void 0)?c.sequence([function(a){return d[113]=new c.Map(),c.nativeOperation(b("LSCreateDebugToken.nop"),d[112],"mailbox_root_key",d[16],c.i64.cast([0,1]),d[113]).then(function(a){return a=a,d[114]=a[0],a})},function(a){return c.blobs.neq(d[114],void 0)?d[115]=d[114]:d[115]=void 0,d[69]=d[115]}]):c.resolve(d[69]=void 0)},function(a){return c.blobs.neq(d[69],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[69]).then(function(a){return a=a,d[113]=a[0],a})},function(a){return d[70]=d[113]}]):c.resolve(d[70]=void 0)},function(a){return c.blobs.neq(d[16],void 0)?c.sequence([function(a){return d[113]=new c.Map(),c.nativeOperation(b("LSCreateDebugToken.nop"),d[16],"ocmf_client_state",d[31],c.i64.cast([0,1]),d[113]).then(function(a){return a=a,d[114]=a[0],a})},function(a){return c.blobs.neq(d[114],void 0)?d[115]=d[114]:d[115]=void 0,d[71]=d[115]}]):c.resolve(d[71]=void 0)},function(a){return c.blobs.neq(d[71],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[71]).then(function(a){return a=a,d[113]=a[0],a})},function(a){return d[72]=d[113]}]):c.resolve(d[72]=void 0)},function(a){return c.db.table(217).put({backupId:d[17],devicePrivateKeyDebugToken:d[64]==null?"":d[64],epochStoragePrivateKeyDebugToken:d[66]==null?"":d[66],epochAuthPrivateKeyDebugToken:d[68]==null?"":d[68],mailboxRootKeyDebugToken:d[70]==null?"":d[70],ocmfClientStateDebugToken:d[72]==null?"":d[72],appVersion:""})},function(a){return d[73]=d[30].get("epoch_id"),d[30],d[74]=d[30].get("epoch_anon_id"),d[30],d[75]=d[30].get("epoch_root_key"),d[30],c.forEach(c.filter(c.db.table(169).fetch([[[d[73]]]]),function(a){return c.i64.eq(a.epochId,d[73])&&c.i64.lt(a.authorityLevel,c.i64.cast([0,20]))}),function(a){return a["delete"]()})},function(a){return c.db.table(169).add({epochId:d[73],authorityLevel:c.i64.cast([0,20]),backupId:d[17],epochAnonIdBlob:d[74],epochRootKeyBlob:d[75],epochStatus:c.i64.cast([0,1])})},function(a){return c.islc(c.filter(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,20]))}),0,c.i64.to_float(c.i64.cast([0,1]))).next().then(function(e,f){var a=e.done;e=e.value;return a?(a=[void 0,void 0,void 0,void 0,void 0,c.i64.cast([0,1]),void 0,void 0,void 0,void 0,void 0,void 0,void 0,c.i64.cast([0,20])],d[76]=a[0],d[77]=a[1],d[78]=a[2],d[79]=a[3],d[80]=a[4],d[81]=a[5],d[82]=a[6],d[83]=a[7],d[84]=a[8],d[85]=a[9],d[86]=a[10],d[87]=a[11],d[88]=a[12],d[89]=a[13],a):(f=e.item,c.sequence([function(a){return d[117]=f.backupTenancy,d[116]=f.encryptionVersion,c.i64.neq(void 0,void 0)?c.resolve(d[113]=void 0):c.sequence([function(a){return d[118]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[119]=a[0],a})},function(a){return d[119]?d[128]=(d[118].push(c.i64.cast([0,0])),d[118]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[120]=a[0],a})},function(a){return d[120]?d[128]=(d[118].push(c.i64.cast([0,2])),d[118]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[121]=a[0],a})},function(a){return d[121]?d[128]=(d[118].push(c.i64.cast([0,3])),d[118]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[122]=a[0],a})},function(a){return d[122]?d[128]=(d[118].push(c.i64.cast([0,4])),d[118]):0,d[123]=c.createArray(),d[124]=c.i64.of_int32(d[118].length),c.i64.gt(d[124],c.i64.cast([0,0]))?c.loopAsync(d[124],function(a){return d[128]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[118],d[128]).then(function(a){return a=a,d[129]=a[0],d[130]=a[1],a})},function(a){return d[131]=(d[123].push(d[129]),d[123])}])}):c.resolve()},function(a){return c.sequence([function(a){return d[128]=c.createArray(),d[129]=c.i64.of_int32(d[123].length),c.i64.gt(d[129],c.i64.cast([0,0]))?c.loopAsync(d[129],function(a){return d[131]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[123],d[131]).then(function(a){return a=a,d[132]=a[0],d[133]=a[1],a})},function(a){return d[134]=(d[128].push(c.i64.to_string(d[132])),d[128])}])}):c.resolve()},function(a){return d[130]=d[128].join(","),d[125]=d[130]}])},function(a){return d[123].some(function(a){return c.i64.eq(d[116],a)})?d[126]=d[116]:d[126]=void 0,c.i64.neq(d[126],void 0)?d[127]=d[126]:d[127]=void 0,d[113]=d[127]}])},function(a){return c.i64.neq(d[113],void 0)?d[114]=d[113]:d[114]=c.i64.cast([0,0]),c.i64.neq(d[117],void 0)?d[115]=d[117]:d[115]=c.i64.cast([0,1]),a=[f.backupId,f.deviceId,f.mailboxRootKeyBlob,f.ocmfClientStateBlob,d[114],d[115],f.epochAuthPublicKeyBlob,f.epochAuthPrivateKeyBlob,f.devicePublicKeyBlob,f.devicePrivateKeyBlob,f.epochStoragePublicKeyBlob,f.epochStoragePrivateKeyBlob,f.obliviousValidationTokenBlob,f.authorityLevel],d[76]=a[0],d[77]=a[1],d[78]=a[2],d[79]=a[3],d[80]=a[4],d[81]=a[5],d[82]=a[6],d[83]=a[7],d[84]=a[8],d[85]=a[9],d[86]=a[10],d[87]=a[11],d[88]=a[12],d[89]=a[13],a}]))})},function(a){return c.blobs.neq(d[78],void 0)?c.sequence([function(a){return c.blobs.neq(d[78],void 0)?c.sequence([function(a){return d[115]=new c.Map(),c.nativeOperation(b("LSCreateDebugToken.nop"),d[78],"epoch_root_key",d[75],c.i64.cast([0,1]),d[115]).then(function(a){return a=a,d[116]=a[0],a})},function(a){return c.blobs.neq(d[116],void 0)?d[117]=d[116]:d[117]=void 0,d[113]=d[117]}]):c.resolve(d[113]=void 0)},function(a){return c.blobs.neq(d[113],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[113]).then(function(a){return a=a,d[115]=a[0],a})},function(a){return d[114]=d[115]}]):c.resolve(d[114]=void 0)},function(a){return c.db.table(218).put({epochId:d[73],epochAnonId:c.blobs.to_string(d[74]),epochRootKeyDebugToken:d[114]==null?"":d[114],appVersion:""})}]):(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsEncryptedBackupsEpochDebugMetadataV2Table] mailbox_root_key is null, skipping generate epoch debug tokens"),d[113]=c.createArray(),void 0!==void 0?d[114]=(d[113].push(void 0),d[113]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsEncryptedBackupsEpochDebugMetadataV2Table","mailbox_root_key is null, skipping generate epoch debug tokens",d[113],c.i64.cast([0,3])))},function(a){return d[91]=d[23].get("device_private_key"),d[23],d[92]=c.createArray(),c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,0])).then(function(a){return a=a,d[93]=a[0],a})},function(a){return d[93]?d[113]=(d[92].push(c.i64.cast([0,0])),d[92]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,2])).then(function(a){return a=a,d[94]=a[0],a})},function(a){return d[94]?d[113]=(d[92].push(c.i64.cast([0,2])),d[92]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,3])).then(function(a){return a=a,d[95]=a[0],a})},function(a){return d[95]?d[113]=(d[92].push(c.i64.cast([0,3])),d[92]):0,c.storedProcedure(b("LSIsEncryptionVersionSecure"),c.i64.cast([0,4])).then(function(a){return a=a,d[96]=a[0],a})},function(a){return d[96]?d[113]=(d[92].push(c.i64.cast([0,4])),d[92]):0,d[97]="",d[98]=c.i64.of_int32(d[92].length),c.i64.gt(d[98],c.i64.cast([0,0]))?c.loopAsync(d[98],function(a){return d[113]=a,c.sequence([function(a){return c.nativeTypeOperation("Array",b("LSArrayGetObjectAt"),d[92],d[113]).then(function(a){return a=a,d[114]=a[0],d[115]=a[1],a})},function(a){return d[97]=[d[97],"_",c.i64.to_string(d[114])].join("")}])}):c.resolve()},function(a){return c.nativeOperation(b("LSGetBlobFromString.nop"),["supported_versions_",d[97],"revision_version_",c.i64.to_string(c.i64.cast([0,1]))].join("")).then(function(a){return a=a,d[99]=a[0],a})},function(a){return c.nativeOperation(b("LSCreateSignature_v2.nop"),d[91],c.blob("Mg=="),d[99]).then(function(a){return a=a,d[100]=a[0],a})},function(a){return c.blobs.neq(d[100],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSBase64Encode.nop"),d[100]).then(function(a){return a=a,d[113]=a[0],a})},function(a){return d[101]=d[113]}]):c.resolve(d[101]=void 0)},function(a){return d[102]=d[30].get("epoch_id"),d[30],d[103]=new c.Map(),d[103].set("supported_encryption_versions",d[92]),d[103].set("client_version",c.i64.cast([0,1])),d[103].set("version_sig",d[101]==null?"":d[101]),d[104]=d[23].get("device_public_key"),d[23],d[105]=d[23].get("device_private_key"),d[23],c.i64.eq(c.i64.cast([0,1]),c.i64.cast([0,2]))?c.resolve(d[106]=void 0):c.sequence([function(a){return c.nativeOperation(b("LSGetArmadilloPublicKey.nop")).then(function(a){return a=a,d[113]=a[0],a})},function(a){return d[106]=d[113]}])},function(a){return c.blobs.neq(d[106],void 0)?c.sequence([function(a){return c.nativeOperation(b("LSCreateSignatureWithArmadilloKey.nop"),d[104]).then(function(a){return a=a,d[113]=a[0],a})},function(a){return c.blobs.neq(d[113],void 0)?c.resolve(d[114]=d[113]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoKeySigningUtils] Failed to create labyrinth signature"),d[118]=c.createArray(),void 0!==void 0?d[119]=(d[118].push(void 0),d[118]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoKeySigningUtils","Failed to create labyrinth signature",d[118],c.i64.cast([0,3]))},function(a){return d[114]=void 0}])},function(a){return c.nativeOperation(b("LSCreateSignature_v2.nop"),d[105],c.blob("Mw=="),d[106]).then(function(a){return a=a,d[115]=a[0],a})},function(a){return c.blobs.neq(d[115],void 0)?c.resolve(d[116]=d[115]):c.sequence([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoKeySigningUtils] Failed to create armadillo signature"),d[118]=c.createArray(),void 0!==void 0?d[119]=(d[118].push(void 0),d[118]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"MEBCryptoKeySigningUtils","Failed to create armadillo signature",d[118],c.i64.cast([0,3]))},function(a){return d[116]=void 0}])},function(a){return c.blobs.neq(d[116],void 0)?(c.blobs.neq(d[114],void 0)?(d[119]=new c.Map(),d[119].set("armadillo_public_key",d[106]),d[119].set("armadillo_key_signature",d[116]),d[119].set("labyrinth_key_signature",d[114]),d[118]=d[119]):d[118]=void 0,d[117]=d[118]):d[117]=void 0,d[107]=d[117]}]):c.resolve(d[107]=void 0)},function(a){return d[107]!==void 0?c.sequence([function(a){return d[113]=d[107].get("armadillo_public_key"),d[107],c.nativeOperation(b("LSBase64Encode.nop"),d[113]).then(function(a){return a=a,d[114]=a[0],a})},function(a){return d[115]=d[107].get("armadillo_key_signature"),d[107],c.nativeOperation(b("LSBase64Encode.nop"),d[115]).then(function(a){return a=a,d[116]=a[0],a})},function(a){return d[117]=d[107].get("labyrinth_key_signature"),d[107],c.nativeOperation(b("LSBase64Encode.nop"),d[117]).then(function(a){return a=a,d[118]=a[0],a})},function(a){return d[119]=new c.Map(),d[119].set("armadillo_public_key",d[114]==null?"":d[114]),d[119].set("armadillo_key_signature",d[116]==null?"":d[116]),d[119].set("labyrinth_key_signature",d[118]==null?"":d[118]),d[108]=d[119]}]):c.resolve((function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsOnboardFromExistingDeviceRegisterStoredProcedure] Failed to get armadillo key and device signatures"),d[108]=void 0))},function(e){return d[109]=new c.Map(),d[109].set("backup_id",d[17]),d[109].set("device_public_key",d[33]==null?"":d[33]),d[109].set("epoch_storage_pubkey",d[40]==null?"":d[40]),d[109].set("epoch_storage_pubkey_sig",d[42]==null?"":d[42]),d[109].set("epoch_auth_pubkey",d[44]==null?"":d[44]),d[109].set("epoch_auth_pubkey_sig",d[46]==null?"":d[46]),d[109].set("ocmf_provider_device_id",a[0]),d[109].set("ocmf_rotation_token",d[48]==null?"":d[48]),d[109].set("device_epoch_hmac",d[35]==null?"":d[35]),d[109].set("epoch_root_key_fingerprint",d[38]),d[109].set("device_registration_id",i.deviceRegistrationId),d[109].set("base_epoch_id",d[102]),d[109].set("encryption_version_data",d[103]),d[109].set("ocmf_client_state_debug_token",d[54]),d[109].set("private_key_debug_token",d[52]),d[109].set("epoch_storage_pvtkey_debug_token",d[56]),d[109].set("occam_only_eligible",!0),d[109].set("armadillo_key_data",d[108]),d[110]=new c.Map(),d[110].set("success",d[109]),d[111]=c.toJSON(d[110]),c.storedProcedure(b("LSIssueNewTask"),"meb_onboard_from_existing_device",c.i64.cast([0,50037]),d[111],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))},function(a){return d[29]=void 0}]):c.sequence([function(a){return d[28]!==void 0?c.sequence([function(a){return d[31]=d[28].get("error_message"),d[28],d[32]=d[28].get("error_code"),d[28],d[33]=new c.Map(),d[33].set("error_code",d[32]),d[33].set("stored_procedure","onboardFromExistingDeviceRegister"),d[33].set("error_message",d[31]),d[34]=new c.Map(),d[34].set("failure",d[33]),d[35]=c.toJSON(d[34]),c.storedProcedure(b("LSIssueNewTask"),"meb_onboard_from_existing_device",c.i64.cast([0,50037]),d[35],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))},function(a){return d[36]=new c.Map(),d[36].set("error_code",d[32]),d[36].set("stored_procedure","LSEncryptedBackupsOnboardFromExistingDeviceRegisterStoredProcedure"),d[36].set("error_message",""),d[30]=d[36]}]):c.sequence([function(a){return d[31]=new c.Map(),d[31].set("error_code",c.i64.cast([0,603])),d[31].set("stored_procedure","onboardFromExistingDeviceRegister"),d[31].set("error_message","Unknown error encountered"),d[32]=new c.Map(),d[32].set("failure",d[31]),d[33]=c.toJSON(d[32]),c.storedProcedure(b("LSIssueNewTask"),"meb_onboard_from_existing_device",c.i64.cast([0,50037]),d[33],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))},function(a){return d[34]=new c.Map(),d[34].set("error_code",c.i64.cast([0,603])),d[34].set("stored_procedure","LSEncryptedBackupsOnboardFromExistingDeviceRegisterStoredProcedure"),d[34].set("error_message",""),d[30]=d[34]}])},function(a){return d[29]=d[30]}])},function(a){return d[22]=d[29]}]):c.sequence([function(a){return d[21]!==void 0?c.sequence([function(a){return d[24]=d[21].get("error_message"),d[21],d[25]=d[21].get("error_code"),d[21],d[26]=new c.Map(),d[26].set("error_code",d[25]),d[26].set("stored_procedure","onboardFromExistingDeviceRegister"),d[26].set("error_message",d[24]),d[27]=new c.Map(),d[27].set("failure",d[26]),d[28]=c.toJSON(d[27]),c.storedProcedure(b("LSIssueNewTask"),"meb_onboard_from_existing_device",c.i64.cast([0,50037]),d[28],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))},function(a){return d[29]=new c.Map(),d[29].set("error_code",d[25]),d[29].set("stored_procedure","LSEncryptedBackupsOnboardFromExistingDeviceRegisterStoredProcedure"),d[29].set("error_message",""),d[23]=d[29]}]):c.sequence([function(a){return d[24]=new c.Map(),d[24].set("error_code",c.i64.cast([0,603])),d[24].set("stored_procedure","onboardFromExistingDeviceRegister"),d[24].set("error_message","Unknown error encountered"),d[25]=new c.Map(),d[25].set("failure",d[24]),d[26]=c.toJSON(d[25]),c.storedProcedure(b("LSIssueNewTask"),"meb_onboard_from_existing_device",c.i64.cast([0,50037]),d[26],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))},function(a){return d[27]=new c.Map(),d[27].set("error_code",c.i64.cast([0,603])),d[27].set("stored_procedure","LSEncryptedBackupsOnboardFromExistingDeviceRegisterStoredProcedure"),d[27].set("error_message",""),d[23]=d[27]}])},function(a){return d[22]=d[23]}])},function(a){return d[18]=d[22]}]))})},function(a){return d[13]=d[18]}]):c.sequence([function(a){return d[18]=new c.Map(),d[18].set("error_code",c.i64.cast([0,24])),d[18].set("stored_procedure","onboardFromExistingDeviceRegister"),d[18].set("error_message","Client state table fetch error"),d[19]=new c.Map(),d[19].set("failure",d[18]),d[20]=c.toJSON(d[19]),c.storedProcedure(b("LSIssueNewTask"),"meb_onboard_from_existing_device",c.i64.cast([0,50037]),d[20],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))},function(a){return d[21]=new c.Map(),d[21].set("error_code",c.i64.cast([0,24])),d[21].set("stored_procedure","LSEncryptedBackupsOnboardFromExistingDeviceRegisterStoredProcedure"),d[21].set("error_message",""),d[13]=d[21]}])},function(a){return d[2]=d[13]}]))})},function(a){return d[4]=c.i64.of_float(Date.now()),d[5]=c.i64.random(),d[7]="Finishing execution. Execution time: ",d[8]=c.i64.to_string(c.i64.sub(d[4],d[0])),d[9]=" ms",d[6]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][onboardFromExistingDeviceRegister] ",d[6],d[7],d[6],d[8],d[6],d[9]].join("")),c.i64.eq(c.i64.mod_(d[5],c.i64.cast([0,100])),c.i64.cast([0,0]))?(d[10]=",",d[11]=c.createArray(),void 0!==void 0?d[12]=(d[11].push(void 0),d[11]):0,c.nativeOperation(b("LSLogMebClientEvent.nop"),"onboardFromExistingDeviceRegister",[d[7],d[10],d[8],d[10],d[9]].join(""),d[11],c.i64.cast([0,4]))):c.resolve()},function(a){return e[0]=d[2]}])},function(a){return c.resolve(e)}])}e.exports=a}),null);