;/*FB_PKG_DELIM*/

__d("DYICheckpointContentQuery_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="5615113848599491"}),null);
__d("MAWRestoreMessagesFromEncryptedBackupsNOP",["I64","LSDataTraceCheckPoint","LSIntEnum","MAWBridgeTraceRecordCheckpointHandler","MAWBridgeUpdateClientRestoreStatus","MAWChatJid","MAWEncryptedBackupsUpdateGlobalRestoreStatus","MAWJobDefinitions","MAWMIC","MAWOfflineQueueStatus","MAWTimedJob","MAWUpdateClientRestoreStatusOperationType","Promise","ReQL","WAJobOrchestratorTypes","WALoggerDeferred","WATagsLogger","asyncToGeneratorRuntime","cr:4992","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Calling worker job for thread "," StartSortKey: "," messagesCount: ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Calling prefetch for thread ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Failed to get thread key for "," when calling restoreMessagesFromEncryptedBackup"]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][","] Received echo documents for thread: "," startSortKey: "," messagesCount: ",""]);n=function(){return a};return a}function o(a,b){return p.apply(this,arguments)}function p(){p=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){try{c=(yield d("MAWChatJid").toThreadKeyMaybe(a,c));if(c!=null){a=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.messages_ranges_v2__generated).getKeyRange(c)));if(a!=null)return a.minMessageId}}catch(a){return(j||(j=b("Promise"))).reject(a)}return});return p.apply(this,arguments)}function q(a,b,c){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){if(b===0){yield d("MAWMIC").startMAWMICFlow();d("MAWMIC").markEvent("eb_restore_start");c&&d("MAWMIC").markEvent("eb_prefetch_start");return d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.mi_act_mapping_table)).then(function(a){a.forEach(function(a){a=d("MAWJobDefinitions").toThreadJidPrimaryId((h||(h=d("I64"))).to_string(a.jid));d("MAWEncryptedBackupsUpdateGlobalRestoreStatus").addThreadIdToStatusArray(a,"restore");c&&d("MAWEncryptedBackupsUpdateGlobalRestoreStatus").addThreadIdToStatusArray(a,"ebprefetch")})})}});return r.apply(this,arguments)}function a(a,b,c,d,e,f,g,h,i,j,k,l){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,h,p,r,s,t,u,v,w){var x;d("WATagsLogger").TAGS(["labyrinth_web","eb_restore",(x=u)!=null?x:""]).LOG(n(),(x=u)!=null?x:"",f,v,g.length);x=(yield d("MAWChatJid").toThreadKeyMaybe(a,f));x==null&&void d("WALoggerDeferred").ERROR(m(),f);x=!d("MAWOfflineQueueStatus").isOfflineQueueComplete()&&b("cr:4992")!=null&&v==null&&f!=null;var y=d("MAWEncryptedBackupsUpdateGlobalRestoreStatus").getCurrentGlobalRestoreStatusArrayLength("restore");yield q(a,y,x);try{y=(yield o(a,f));if(x&&b("cr:4992")!=null){d("WATagsLogger").TAGS(["labyrinth_web","eb_prefetch",(x=u)!=null?x:""]).LOG(l(),f);x={action:d("MAWUpdateClientRestoreStatusOperationType").upsertClientRestoreStatus,threadId:f};yield d("MAWBridgeUpdateClientRestoreStatus").call(a,x);yield b("cr:4992")(a,e,f,g,h,p,r,s,t,u,v,y,w)}else{d("WATagsLogger").TAGS(["labyrinth_web","eb_restore",(x=u)!=null?x:""]).LOG(k(),f,v,g.length);c("promiseDone")(d("MAWTimedJob").TimedUIJobStarters.fireAndForget(d("MAWJobDefinitions").jobSerializers.restoreMessagesFromEncryptedBackups(e,f,g,h,r,t,(p=y)!=null?p:void 0,(s=u)!=null?s:void 0,(x=v)!=null?x:void 0,void 0,void 0,w,{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION})))}}catch(e){if(u!=null)return d("MAWBridgeTraceRecordCheckpointHandler").call(a,{checkPointId:(i||(i=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").FLOW_END_FOR_FAILURE),dataTraceId:u,errorMessage:e,shouldFlush:!0,syncChannel:-1,tags:void 0}).then(function(){return(j||(j=b("Promise"))).reject(e)})}});return s.apply(this,arguments)}g.call=a}),98);